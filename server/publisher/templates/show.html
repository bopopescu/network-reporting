{% extends 'publisher/base.html' %}{% load filters %}
{% block pageTitle %}
          <div class="breadcrumb">
            <a class="linkIcon breadcrumb-back" href="{% url publisher_app_show app_key=adunit.app_key.key %}"><span class="ui-icon ui-icon-arrowthick-1-w"></span> Back to App</a>
            <h1>{{adunit.name}}</h1>
          </div>{% endblock pageTitle %}
{% block titleBarRight %}
            <span class="titlebar-right">
              <a class="button" id="dashboard-apps-editAdUnitButton" href="#">Edit ad unit settings</a>
              <a class="linkIcon" href="{% url publisher_generate adunit_key=adunit.key %}">Get code snippet <span class="ui-icon ui-icon-triangle-1-e"></span></a>
            </span>
{% endblock titleBarRight %}
{% block messageCenter %}{% endblock messageCenter %}

{% block content %}{% if not adunit.adgroups %}
          <div class="alertMessage">
            There are no campaigns targeting this ad unit.  To show ads here, set up a new ad campaign or add this ad unit to an existing campaign on the <a href="{% url advertiser_campaign %}">Campaigns</a> page.
          </div>
{% endif %}
          <section id="dashboard-adunitEditForm" class="hidden">
            <div>
              <a name="adunitForm" class="hidden">anchor</a>
              <form action="{% url publisher_adunit_update_ajax %}" method="POST" accept-charset="utf-8" id="adunitAddForm" class="adunitEditForm validate">
                <fieldset id="appForm-details" class="alt">
                  <input type="hidden" name="adunit_key" value="{{adunit.key}}"/>
                  <div id="adunitForm-fragment">
                    {{adunit_form_fragment}}
                  </div>  
                  <div class="form-submit"> 
                    <span class="hidden" id="adunitForm-loading"><img src="/images/loading2.gif"/></span>
                    <span class="buttonWrap"><a href="#" class="button" id="adunitEditForm-submit">Save</a></span> 
                    <span class="buttonWrap"><a href="#" class="button" id="adunitEditForm-cancel">Cancel</a></span> 
                  </div> 
                </fieldset>
              </form>
            </div>
          </section>
          <section class="offset nomargin" id="dashboard-stats">
            <div class="stats">
              <div class="stats-breakdown">
                <table>
                  <tbody>
                    <tr class="active" id="stats-breakdown-requests">
                      <td class="stats-breakdown-value today"><span class="inner">{{today.request_count|withsep}}</span></td>
                      <td class="stats-breakdown-value yesterday"><span class="inner">{{yesterday.request_count|withsep}}</span></td>
                      <td class="stats-breakdown-value all"><span class="inner">{{adunit.stats.request_count|withsep}}</span></td>
                      <th class="stats-breakdown-name"><span class="inner">Requests</span></th>
                    </tr>
                    <tr id="stats-breakdown-impressions">
                      <td class="stats-breakdown-value today"><span class="inner">{{today.impression_count|withsep}}</span></td>
                      <td class="stats-breakdown-value yesterday"><span class="inner">{{yesterday.impression_count|withsep}}</span></td>
                      <td class="stats-breakdown-value all"><span class="inner">{{adunit.stats.impression_count|withsep}}</span></td>
                      <th class="stats-breakdown-name"><span class="inner">Impressions</span></th>
                    </tr>
                    <tr id="stats-breakdown-clicks">
                      <td class="stats-breakdown-value today"><span class="inner">{{today.click_count|withsep}}</span></td>
                      <td class="stats-breakdown-value yesterday"><span class="inner">{{yesterday.click_count|withsep}}</span></td>
                      <td class="stats-breakdown-value all"><span class="inner">{{adunit.stats.click_count|withsep}}</span></td>
                      <th class="stats-breakdown-name"><span class="inner">Clicks</span></th>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="stats-breakdown-buttons">
                <span class="buttonset button-small" id="stats-breakdown-dateOptions">
                  <input type="radio" name="stats-breakdown-dateOptions-option" value="today" id="stats-breakdown-dateOptions-option-0" checked="checked"/>
                  <label for="stats-breakdown-dateOptions-option-0">Today</label>
                  <input type="radio" name="stats-breakdown-dateOptions-option" value="yesterday" id="stats-breakdown-dateOptions-option-1"/>
                  <label for="stats-breakdown-dateOptions-option-1">Yesterday</label>
                  <input type="radio" name="stats-breakdown-dateOptions-option" value="all" id="stats-breakdown-dateOptions-option-2"/>
                  <label for="stats-breakdown-dateOptions-option-2">All</label>
                </span>
              </div>
              <div class="chart chart-loading stats-chart" id="dashboard-stats-chart">
                <div class="chart-loading-text">Loading ...</div>
                <div class="chart-error-text">Could not load chart</div>
                <script type="text/javascript">
                  // chart data
                  mopub.dashboardStatsChartData = {
                    //pointStart: 1294963200000,
                    pointStart: Date.UTC({{start_date.year}},{{start_date.month|add:"-1"}},{{start_date.day}}),
                    pointInterval: 86400000,
                    'requests': [
                      { '{{adunit.name|safe|addslashes}}': [{% for t in adunit.all_stats %}{{t.request_count}}{% if not forloop.last %},{% endif %} {% endfor %}] }
                    ],
                    'impressions': [
                      { '{{adunit.name|safe|addslashes}}': [{% for t in adunit.all_stats %}{{t.impression_count}}{% if not forloop.last %},{% endif %} {% endfor %}] }
                    ],
                    'clicks': [
                      { '{{adunit.name|safe|addslashes}}': [{% for t in adunit.all_stats %}{{t.click_count}}{% if not forloop.last %},{% endif %} {% endfor %}] }
                    ]
                  };
                </script>
              </div>
            </div>
            <div class="clear"></div>
          </section>

          <div class="clear"></div>

          <section id="dashboard-apps">
            <h2>Campaigns</h2>
            
            <div class="buttonBank buttonBank-right">
              <a class="button" id="advertisers-testAdServer" href="#">Run Auction</a>
            </div>
            
            <div id="adserverTest" style="display:none;">
              <iframe height="480" width="350" id="adserverTest-iFrame" scrolling="no">
              </iframe>    
              <div id="adserverTest-iFrame-src" style="display:none;">{% url advertiser_adserver_test %}?id={{adunit.key}}</div>    
            </div>
	        

            

	        
            <div>
              {% if adunit.adgroups %}
              
			  <div class="appData alternating-color">	
				<div class="appData-details noneg">
	                <div class="appData-details-inner show">
	                  <table class="dataTable appData-main">
						<thead>
							<tr>
							    <th class="dataTable-name big">Guaranteed</th>
				                <th class="dataTable-data numeric special">Revenue</th>
				                <th class="dataTable-data numeric special">Attempts</th>
				                <th class="dataTable-data numeric special">Impressions</th>
				                <th class="dataTable-data numeric special">Fillrate</th>
				                <th class="dataTable-data numeric special">Clicks</th>
				                <th class="dataTable-data numeric special">CTR</th>
							</tr>
			            </thead>
	                    <tbody>
						  {% for level in gtee %}
						  {% for ag in level.adgroups %}
	 					  <tr>
	                        <th class="dataTable-name"><span class="inner"><a href="{% url advertiser_adgroup_show adgroup_key=ag.key %}">{{ag.name}} {% if level.name != "normal" %} (priority: {{level.name}}) {% endif %}</a>{% if not ag.active %}<span class="muted"> (Paused)</span>{% endif %}</span></th>
	                        <td class="dataTable-data numeric">{{ag.stats.revenue|currency}}</td>
							<td class="dataTable-data numeric">&nbsp;</td>
	                        <td class="dataTable-data numeric">{{ag.stats.impression_count|withsep}}</td>
							<td class="dataTable-data numeric">&nbsp;</td>
	                        <td class="dataTable-data numeric">{{ag.stats.click_count|withsep}}</td>
	                        <td class="dataTable-data numeric">{{ag.stats.ctr|percentage}}</td>
	                      </tr>
	                      {% endfor %}
						  {% endfor %}
	                    </tbody>
	                  </table>
	                </div>       
                </div>
			  </div>	

			  <div class="appData alternating-color">	
				<div class="appData-details noneg">
	                <div class="appData-details-inner show">
	                  <table class="dataTable appData-main">
						<thead>
							<tr>
							    <th class="dataTable-name big">Promotional</th>
				                <th class="dataTable-data numeric special">Revenue</th>
				                <th class="dataTable-data numeric special">Attempts</th>
				                <th class="dataTable-data numeric special">Impressions</th>
				                <th class="dataTable-data numeric special">Fillrate</th>
				                <th class="dataTable-data numeric special">Clicks</th>
				                <th class="dataTable-data numeric special">CTR</th>
							</tr>
			            </thead>
	                    <tbody>
                          {% for ag in promo %}
                          <tr>
                            <th class="dataTable-name"><span class="inner"><a href="{% url advertiser_adgroup_show adgroup_key=ag.key %}">{{ag.name}}</a>{% if not ag.active %}<span class="muted"> (Paused)</span>{% endif %}</span></th>
                            <td class="dataTable-data numeric">{{ag.stats.revenue|currency}}</td>
                            <td class="dataTable-data numeric">&nbsp;</td>
                            <td class="dataTable-data numeric">{{ag.stats.impression_count|withsep}}</td>
                            <td class="dataTable-data numeric">&nbsp;</td>
                            <td class="dataTable-data numeric">{{ag.stats.click_count|withsep}}</td>
                            <td class="dataTable-data numeric">{{ag.stats.ctr|percentage}}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
	                  </table>
	                </div>       
                </div>
			  </div>	

			  <div class="appData alternating-color">	
				<div class="appData-details noneg">
	                <div class="appData-details-inner show">
	                  <table class="dataTable appData-main">
						<thead>
							<tr>
							    <th class="dataTable-name big">Network</th>
				                <th class="dataTable-data numeric special">Revenue</th>
				                <th class="dataTable-data numeric special">Attempts</th>
				                <th class="dataTable-data numeric special">Impressions</th>
				                <th class="dataTable-data numeric special">Fillrate</th>
				                <th class="dataTable-data numeric special">Clicks</th>
				                <th class="dataTable-data numeric special">CTR</th>
							</tr>
			            </thead>
	                    <tbody>
                          {% for ag in network %}
                          <tr>
                            <th class="dataTable-name"><span class="inner"><a href="{% url advertiser_adgroup_show adgroup_key=ag.key %}">{{ag.name}}</a>{% if not ag.active %}<span class="muted"> (Paused)</span>{% endif %}</span></th>
                            <td class="dataTable-data numeric">&nbsp;</td>
                            <td class="dataTable-data numeric">{{ag.stats.request_count|withsep}}</td>
                            <td class="dataTable-data numeric">{{ag.stats.impression_count|withsep}}</td>
                            <td class="dataTable-data numeric">{{ag.stats.fill_rate|percentage}}</td>
                            <td class="dataTable-data numeric">{{ag.stats.click_count|withsep}}</td>
                            <td class="dataTable-data numeric">{{ag.stats.ctr|percentage}}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
	                  </table>
	                </div>       
                </div>
			  </div>	

              <div class="appData alternating-color">	
  				<div class="appData-details noneg">
  	                <div class="appData-details-inner show">
  	                  <table class="dataTable appData-main">
  						<thead>
  							<tr>
  							    <th class="dataTable-name big">Backfill Promotional</th>
  				                <th class="dataTable-data numeric special">Revenue</th>
  				                <th class="dataTable-data numeric special">Attempts</th>
  				                <th class="dataTable-data numeric special">Impressions</th>
  				                <th class="dataTable-data numeric special">Fillrate</th>
  				                <th class="dataTable-data numeric special">Clicks</th>
  				                <th class="dataTable-data numeric special">CTR</th>
  							</tr>
  			            </thead>
  	                    <tbody>
	                      {% for ag in backfill_promo %}
	 					  <tr>
	                        <th class="dataTable-name"><span class="inner"><a href="{% url advertiser_adgroup_show adgroup_key=ag.key %}">{{ag.name}}</a>{% if not ag.active %}<span class="muted"> (Paused)</span>{% endif %}</span></th>
	                        <td class="dataTable-data numeric">{{ag.stats.revenue|currency}}</td>
							<td class="dataTable-data numeric">&nbsp;</td>
	                        <td class="dataTable-data numeric">{{ag.stats.impression_count|withsep}}</td>
							<td class="dataTable-data numeric">&nbsp;</td>
	                        <td class="dataTable-data numeric">{{ag.stats.click_count|withsep}}</td>
	                        <td class="dataTable-data numeric">{{ag.stats.ctr|percentage}}</td>
	                      </tr>
	                      {% endfor %}
	                    </tbody>
  	                  </table>
  	                </div>       
                  </div>
  			  </div>
  			  
			  {% else %}
              <table class="dataTable appData-main">
                <tbody>
                  <tr>
                    <td class="campaignData-icon"></td>
                    <th class="dataTable-name"><span class="muted">None</span></th>
                  </tr>
                </tbody>
              </table>
              {% endif %}
            </div>            
          </section>

          <section id="dashboard-apps">
			<div>
              <a class="button button-small" href="/inventory/export/csv/adunit/{{adunit.key}}?spec=days">Export CSV</a>
              <a class="button button-small" href="/inventory/export/xls/adunit/{{adunit.key}}?spec=days">Export XLS</a>	
			</div>
          </section>
{% endblock content %}
