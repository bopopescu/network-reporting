<script type='text/javascript' src='/js/countries.js'></script>
<script type='text/javascript' src='/js/tokenize_in.js'></script>
 <link rel='stylesheet' type='text/css' href='/css/token-input-mopub.css'></link>
 <!-- <link rel='stylesheet' type='text/css' href='/css/token-input-mac.css'></link> -->
<script type='text/javascript'>
    $(document).ready( function () {
            var priors = {{form.geo.value|safe}};
            var pre = [];
            for (var count = 0; count < countries.length; count++) {
                var dat = countries[count];
                if ($.inArray(dat.code, priors) != -1) {
                    pre.push(dat);
                }
                if (pre.length == priors.length)
                    break;
            }
            //Need to create data object that is array of dictionary [ {name, id} ] 

            $('#geo_pred_ta').tokenInput( null, { data: countries,
                                                  formatResult: function( row ) {
                                                        return row.name;
                                                        },
                                                  formatMatch: function( row, i, max ){
                                                        return [row.name, row.code];
                                                        },
                                                  prePopulate: pre 
                });
    });
</script>
                    <dl class="formFields"> 
                      <dt><label for="TODO5">Ad Units:</label></dt>
                      <dd> 
                        <ul style="overflow:auto; max-height:200px; list-style: none;padding:5px 10px" class="{% if form.site_keys.errors %}form-error{% endif %}"> 
                        {% for adunit in all_adunits %}   
                          <li><input type="checkbox" name="site_keys" value="{{adunit.key}}"{% if adunit.checked %} checked="checked"{% endif %}> {{adunit.app.name}} &gt; {{adunit.name}} </input></li>   
                        {% endfor %}   
                        </ul>  
                        {% for error in form.site_keys.errors %}
                        <div class="form-error-text">{{error}}</div> 
                        {% endfor %}
                      </dd>
                      <div class="adgroupForm-advanced hidden">
                        <dt><label for="TODO6">Allocation:</label></dt>
                        <dd>
                          <input type="text" class="input-text input-text-number {% if form.allocation_percentage.errors %}form-error{% endif %}" name="{{form.allocation_percentage.name}}" value="{{form.allocation_percentage.value}}"/> % of all 
                          <select name="{{form.allocation_type.name}}">
                            <option value="users" {% if not form.allocation_type.value %}selected="selected"{% endif %}{% ifequal form.allocation_type.value 'users' %}checked="checked"{% endifequal %}>Users</option>
                            <option value="requests" {% ifequal form.allocation_type.value 'requests' %}selected="selected"{% endifequal %}>Requests</option>
                          </select>
                          {% for error in form.percent_users.errors %}
                          <div class="form-error-text">{{error}}</div> 
                          {% endfor %}
                        </dd>
                        
                        <dt><label for="TODO7">Frequency Caps:</label></dt>
                        <dd>
                          <input name="{{form.daily_frequency_cap.name}}" class="input-text input-text-number {% if form.daily_frequency_cap.errors %}form-error{% endif %}" type="text" value="{{form.daily_frequency_cap.value}}"/> daily impressions per user <br/>
                          {% for error in form.daily_frequency_cap.errors %}
                          <div class="form-error-text">{{error}}</div> 
                          {% endfor %}
                          <input name="{{form.hourly_frequency_cap.name}}" class="input-text input-text-number {% if form.hourly_frequency_cap.errors %}form-error{% endif %}" type="text" value="{{form.hourly_frequency_cap.value}}"/> hourly impressions per user
                          {% for error in form.hourly_frequency_cap.errors %}
                          <div class="form-error-text">{{error}}</div> 
                          {% endfor %}
                        </dd> 
                        
                        <dt><label for="TODO8">Keywords:</label></dt>
                        <dd><textarea cols="50" rows="3" name="{{form.keywords.name}}" class="{% if form.keywords.errors %}form-error{% endif %}" placeholder="Keywords, one per line, e.g. coffee">{{form.keywords.value}}</textarea>
                          {% for error in form.keywords.errors %}
                          <div class="form-error-text">{{error}}</div> 
                          {% endfor %}
                        </dd>
                        <dt><label for="TODO9">Geo Predicates:</label></dt>
                        <dd>
                          <div id='geo_pred_ta' name='geo_predicates'></div>
                          <!--
                          <textarea id='geo_pred_ta' name="geo_predicates" class="{% if form.geo_predicates.errors %}form-error{% endif %}">{% if form.geo_predicates.value %}{{form.geo_predicates.value}}{% else %}country_name=*{% endif %}</textarea> -->
                          {% for error in form.geo_predicates.errors %}
                          <div class="form-error-text">{{error}}</div>
                          {% endfor %}
                        </dd>
                        {# <dt><label for="TODO10">Device Predicates:</label></dt> #}
                        {# <dd> #}
                        {#   <textarea name="device_predicates" class="{% if form.device_predicates.errors %}form-error{% endif %}">{% if form.geo_predicates.value %}{{form.device_predicates.value}}{% else %}platform_name=*{% endif %}</textarea> #}
                        {#   <div>platform_name=(*,android,iphone)</div> #}
                        {#   {% for error in form.device_predicates.errors %} #}
                        {#   <div class="form-error-text">{{error}}</div> #}
                        {#   {% endfor %} #}
                        {# </dd> #}
                      </div>
                      <dt><a class="button button-small adgroupForm-advanced-toggleButton" id="adgroupForm-advanced-toggleButton" href="#">Show Advanced Targeting</a></dt> 
                      <dd></dd> 
                    </dl>
