{% extends "networks_base.html" %}
{% load filters %}

{% block pageTitle %}
<h1>
    <a href="{% url networks %}">Networks</a> / {{network.pretty_name}}
</h1>
{% endblock pageTitle %}

{% block titleBarRight %}
<span class="titlebar-right">
    <a class="button" id="network-settingsButton" href="{% url edit_network campaign_key=network.campaign_key %}">Edit Network Settings</a>
</span>
{% endblock titleBarRight %}

{% block innerContent %}
{% if login.state == LoginStates.PULLING_DATA or login.state == LoginStates.ERROR %}
<section id="login-state-message">
    <div class="alert-message block-message warning">
        {% if login.state == LoginStates.PULLING_DATA %}
        MoPub is currently collecting data from {{ network.pretty_name }}. You will receive an email when we finish.
        {% else %}
        MoPub received an error last time we tried to collect data from {{ network.pretty_name }}. Please verify that your login credentials are correct and haven't changed. If the problem persists please reach out to us at support@mopub.com.
        {% endif %}
    </div>
</section>
{% endif %}

<section id="aggregate-stats">
    <div class="appData-columnHeaders">
        <table class="dataTable" width=100%>
            <thead>
                <th class="networkData-icon" style="width:75px"></th>
                <th class="dataTable-name"> </th>
                {% if reporting %}
                <th class="dataTable-data numeric"> Revenue </th>
                <th class="dataTable-data numeric"> CPM </th>
                {% endif %}
                <th class="dataTable-data numeric"> Attempts </th>
                <th class="dataTable-data numeric"> Impressions </th>
                <th class="dataTable-data numeric"> Fill Rate </th>
                <th class="dataTable-data numeric"> Clicks </th>
                <th class="dataTable-data numeric"> CTR </th>
            </thead>
        </table>
    </div>
    <div class="appData">
        <table class="dataTable appData-main">
            <tbody>
                <tr id="{{network.campaign_key}}-row">
                    <td class="networkData-icon">
                        <img src="/images/{{network.name}}-transparent.png" alt="{{network.pretty_name}}" width="75" height="25" />
                        <div>
                            {% if network.active %}
                            <select id='network-editActive' class='selectmenu'>
                                <option value="active"> Running </option>
                                <option value="">Paused</option>
                            </select>
                            {% else %}
                            <select id='network-editActive' class='selectmenu'>
                                <option value="">Paused</option>
                                <option value="active">Running</option>
                            </select>
                            {% endif %}
                        </div>
                    </td>
                    <td class="dataTable-name">
                        {{network.pretty_name}}
                        <div style="margin-top:10px;">
                            Targeting: {{ network.targeting }}
                        </div>
                    </td>
                    {% if reporting %}
                    <td class="dataTable-data numeric">
                        <div class="networks-revenue" style="color:orange;">--</div>
                    </td>
                    <td class="dataTable-data numeric">
                        <div class="networks-cpm" style="color:orange;">--</div>
                    </td>
                    {% endif %}
                    <td class="dataTable-data numeric">
                        {% if reporting and network.name != MOBFOX %}
                        <div class="networks-attempt_count network-data">--</div>
                        {% endif %}
                        <div class="all-attempt_count mopub-data">--</div>
                    </td>
                    <td class="dataTable-data numeric">
                        {% if reporting %}
                        <div class="networks-impression_count network-data">--</div>
                        {% endif %}
                        <div class="all-impression_count mopub-data">--</div>
                    </td>
                    <td class="dataTable-data numeric">
                        {% if reporting %}
                        <div class="networks-fill_rate network-data">--</div>
                        {% endif %}
                        <div class="all-fill_rate mopub-data">--</div>
                    </td>
                    <td class="dataTable-data numeric">
                        {% if reporting %}
                        <div class="networks-click_count network-data">--</div>
                        {% endif %}
                        <div class="all-click_count mopub-data">--</div>
                    </td>
                    <td class="dataTable-data numeric">
                        {% if reporting %}
                        <div class="networks-ctr network-data">--</div>
                        {% endif %}
                        <div class="all-ctr mopub-data">--</div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</section>

<section>
<h2>App Targeting</h2>
<div class="appData-columnHeaders">
    <table class="dataTable" width=100%>
        <thead>
            <th class="networkData-icon" style="width:75px"></th>
            <th class="dataTable-name"></th>
            {% if reporting %}
            <th class="dataTable-data numeric"> Revenue </th>
            {% endif %}
            <th class="dataTable-data numeric">
                <a id="campaign-ecpm-helpLink" class="whatsthis" href="#"><div class="whatsthis-icon"></div></a>
                CPM
            </th>
            <th class="dataTable-data numeric"> Attempts </th>
            <th class="dataTable-data numeric"> Impressions </th>
            <th class="dataTable-data numeric"> Fill Rate </th>
            <th class="dataTable-data numeric"> Clicks </th>
            <th class="dataTable-data numeric"> CTR </th>
        </thead>
    </table>
</div>
{% for app in network.mopub_app_stats %}
<div class="{% cycle 'appData' 'appData appData-alt' %}">
    <table class="dataTable appData-main">
        <tbody id="{{app.key}}-stats">
            <tr id="{{app.key}}-row">
                <td class="appData-icon">
                    <a href="/inventory/app/{{app.key_}}">
                        <img src="{% if app.icon_url %}{{app.icon_url}}{% else %}/placeholders/image.gif{% endif %}" alt="Icon" width="45" height="45" />
                    </a>
                </td>
                <td class="dataTable-name">
                    <a href="/inventory/app/{{app.key_}}">{{app.name}}</a>
                    <span class="muted unbold">({{app.app_type_text}})</span>
                </td>
                {% if reporting %}
                <td class="dataTable-data numeric">
                    <div class="network-revenue" style="color:orange;"></div>
                </td>
                <td class="dataTable-data numeric">
                    <div class="network-cpm" style="color:orange;"></div>
                </td>
                {% endif %}
                <td class="dataTable-data numeric">
                    {% if reporting and network.name != MOBFOX %}
                    <div class="network-attempt_count network-data"></div>
                    {% endif %}
                    <div class="mopub-attempt_count mopub-data"></div>
                </td>
                <td class="dataTable-data numeric">
                    {% if reporting %}
                    <div class="network-data network-impression_count"></div>
                    {% endif %}
                    <div class="mopub-impression_count mopub-data"></div>
                </td>
                <td class="dataTable-data numeric">
                    {% if reporting and network.name != MOBFOX %}
                    <div class="network-data network-fill_rate"></div>
                    {% endif %}
                    <div class="mopub-fill_rate mopub-data"></div>
                </td>
                <td class="dataTable-data numeric">
                    {% if reporting %}
                    <div class="network-data network-click_count"></div>
                    {% endif %}
                    <div class="mopub-click_count mopub-data"></div>
                </td>
                <td class="dataTable-data numeric">
                    {% if reporting %}
                    <div class="network-data network-ctr"></div>
                    {% endif %}
                    <div class="mopub-ctr mopub-data"></div>
                </td>
            </tr>
        </tbody>
    </table>
    <div class="appData-details" style="margin: -10px 0 0 86px">
        <table class="dataTable">
            <tbody id="{{app.key}}-adunits">
            </tbody>
        </table>
    </div>
</div>
{% endfor %}

</section>

<section>
    <a class="button" id="delete-network">Delete this network</a>
    <div class="hidden delete-network">
        <h3> Are you sure you want to delete this network? </h3>
    </div>
</section>

{# Help Content #}
<div id="campaign-ecpm-helpContent" class="hidden">
    <h3>Revenue Optimized Campaign CPM</h3>
    <p>We calculate the <strong>CPM</strong> for CPC campaigns by combining the CPC of the campaign with our CTR calculated in real time.</p>
    <p>This number may vary over time. This is perfectly natural and our system will adjust to these fluctuations in real time.</p>
    <p>Campaigns that have not yet begun use the average CTR of the entire app to calculate CPM.</p>
</div>
{% endblock innerContent %}

{% block extraScripts %}
{{ block.super }}
<script>
    $(function () {
        var graph_start_date = Date.UTC({{ start_date.year }}, {{ start_date.month|add:"-1" }}, {{ start_date.day }});

        NetworkDetailsController.initialize({
            campaign_data: {{ campaign_data|safe }},
            graph_start_date: graph_start_date,
            today: {{ today|safe }},
            yesterday: {{ yesterday|safe }},
            ajax_query_string: 's={{ start_date.year }}-{{ start_date.month }}-{{ start_date.day }}&r={{ date_range }}'});
    });
</script>
{% endblock extraScripts %}

