# 174.253.18.133 - - [23/Mar/2011:15:57:21 -0700] "GET /m/imp?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGOj6IAw&udid=577a639187e2ff11 HTTP/1.1" 200 146 "http://ads.mopub.com/" "Mozilla/5.0 (Linux; U; Android 2.2.1; en-us; DROIDX Build/VZW) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 0.1.0.2 - - [23/Mar/2011:15:57:21 -0700] "GET /m/req?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGOj6IAw HTTP/1.1" 200 126 "http://ads.mopub.com/m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=22a0000024650332" "AppEngine-Google; (+http://code.google.com/appengine)"
# 97.137.82.174 - - [23/Mar/2011:15:57:22 -0700] "GET /m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=22a0000024650332 HTTP/1.1" 200 2180 - "Mozilla/5.0 (Linux; U; Android 2.1-update1; en-us; SCH-I500 Build/ECLAIR) AppleWebKit/530.17 (KHTML, like Gecko) Version/4.0 Mobile Safari/530.17,gzip(gfe),gzip(gfe),gzip(gfe)"
# 97.137.82.174 - - [23/Mar/2011:15:57:22 -0700] "GET /m/imp?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGOj6IAw&udid=22a0000024650332 HTTP/1.1" 200 146 "http://ads.mopub.com/" "Mozilla/5.0 (Linux; U; Android 2.1-update1; en-us; SCH-I500 Build/ECLAIR) AppleWebKit/530.17 (KHTML, like Gecko) Version/4.0 Mobile Safari/530.17,gzip(gfe),gzip(gfe),gzip(gfe)"
# 0.1.0.2 - - [23/Mar/2011:15:57:22 -0700] "GET /m/req?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGNbbIAw HTTP/1.1" 200 126 "http://ads.mopub.com/m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=c417c14e64b70e34" "AppEngine-Google; (+http://code.google.com/appengine)"
# 0.1.0.2 - - [23/Mar/2011:15:57:22 -0700] "GET /_ah/queue/bulk-log-processor?account_name=agltb3B1Yi1pbmNyIgsSB0FjY291bnQiFTExMTYwMzg4NTI0MzgzNzUzNDQxMAw&time=130092103 HTTP/1.1" 200 124 "http://ads.mopub.com/m/ad?v=2&f=320x50&udid=3f7c8268742dc7baa91e657b99570dded97bd360&q=Local%20Favorites&id=agltb3B1Yi1pbmNyDAsSBFNpdGUYsbIDDA&w=0.000000&h=0.000000&ll=1.270692,103.824623" "AppEngine-Google; (+http://code.google.com/appengine)"
# 174.255.228.96 - - [23/Mar/2011:15:57:22 -0700] "GET /m/track?v=2&id=agltb3B1Yi1pbmNyCwsSA0FwcBjhvwoM&udid=c7435ae3beb8abad HTTP/1.1" 200 301 - "Apache-HttpClient/UNAVAILABLE (java 1.4),gzip(gfe),gzip(gfe),gzip(gfe)"
# 0.1.0.2 - - [23/Mar/2011:15:57:22 -0700] "GET /_ah/queue/bulk-log-processor?account_name=agltb3B1Yi1pbmNyIgsSB0FjY291bnQiFTEwODEwOTE2NzA5NjEwOTMwMjAzOQw&time=130092103 HTTP/1.1" 200 124 "http://ads.mopub.com/m/imp?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGOj6IAw&udid=9774d56d682e549c" "AppEngine-Google; (+http://code.google.com/appengine)"
# 98.242.122.5 - - [23/Mar/2011:15:57:23 -0700] "GET /m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=c417c14e64b70e34 HTTP/1.1" 200 1865 - "Mozilla/5.0 (Linux; U; Android 2.2.1; en-us; ADR6400L Build/FRG83D) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 0.1.0.2 - - [23/Mar/2011:15:57:23 -0700] "GET /m/req?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGJvEIAw HTTP/1.1" 200 126 "http://ads.mopub.com/m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=200145745b8f5736" "AppEngine-Google; (+http://code.google.com/appengine)"
# 98.242.122.5 - - [23/Mar/2011:15:57:23 -0700] "GET /m/imp?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGNbbIAw&udid=c417c14e64b70e34 HTTP/1.1" 200 146 "http://ads.mopub.com/" "Mozilla/5.0 (Linux; U; Android 2.2.1; en-us; ADR6400L Build/FRG83D) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 84.100.49.181 - - [23/Mar/2011:15:57:25 -0700] "GET /m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=200145745b8f5736 HTTP/1.1" 200 5811 - "Mozilla/5.0 (Linux; U; Android 2.2; fr-fr; HTC Desire Build/FRF91) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 84.100.49.181 - - [23/Mar/2011:15:57:27 -0700] "GET /m/imp?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGJvEIAw&udid=200145745b8f5736 HTTP/1.1" 200 146 "http://ads.mopub.com/" "Mozilla/5.0 (Linux; U; Android 2.2; fr-fr; HTC Desire Build/FRF91) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 0.1.0.2 - - [23/Mar/2011:15:57:27 -0700] "GET /m/req?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGJvEIAw HTTP/1.1" 200 126 "http://ads.mopub.com/m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=c417c14e64b70e34" "AppEngine-Google; (+http://code.google.com/appengine)"
# 98.242.122.5 - - [23/Mar/2011:15:57:28 -0700] "GET /m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=c417c14e64b70e34 HTTP/1.1" 200 5811 - "Mozilla/5.0 (Linux; U; Android 2.2.1; en-us; ADR6400L Build/FRG83D) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 0.1.0.2 - - [23/Mar/2011:15:57:31 -0700] "GET /m/req?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGJmSIQw HTTP/1.1" 200 126 "http://ads.mopub.com/m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=c417c14e64b70e34&exclude=admob" "AppEngine-Google; (+http://code.google.com/appengine)"
# 98.242.122.5 - - [23/Mar/2011:15:57:31 -0700] "GET /m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=c417c14e64b70e34&exclude=admob HTTP/1.1" 200 2270 - "Mozilla/5.0 (Linux; U; Android 2.2.1; en-us; ADR6400L Build/FRG83D) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 98.242.122.5 - - [23/Mar/2011:15:57:32 -0700] "GET /m/imp?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGJmSIQw&udid=c417c14e64b70e34 HTTP/1.1" 200 146 "http://ads.mopub.com/" "Mozilla/5.0 (Linux; U; Android 2.2.1; en-us; ADR6400L Build/FRG83D) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 0.1.0.2 - - [23/Mar/2011:15:57:32 -0700] "GET /_ah/queue/bulk-log-processor?account_name=agltb3B1Yi1pbmNyIgsSB0FjY291bnQiFTEwODEwOTE2NzA5NjEwOTMwMjAzOQw&time=130092104 HTTP/1.1" 200 124 "http://ads.mopub.com/m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=577a639187e2ff11" "AppEngine-Google; (+http://code.google.com/appengine)"
# 0.1.0.2 - - [23/Mar/2011:15:57:32 -0700] "GET /_ah/queue/bulk-log-processor?account_name=agltb3B1Yi1pbmNyIgsSB0FjY291bnQiFTEwMzI2MTQyNDE5MzI3NDU1MDMxOAw&time=130092104 HTTP/1.1" 200 124 "http://ads.mopub.com/m/ad?v=3&udid=d9dfa12b07ed83850e8a1e1d4b924fe311c6c810&q=&id=agltb3B1Yi1pbmNyDAsSBFNpdGUYmcIRDA" "AppEngine-Google; (+http://code.google.com/appengine)"
# 0.1.0.2 - - [23/Mar/2011:15:57:32 -0700] "GET /m/req?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGJmSIQw HTTP/1.1" 200 126 "http://ads.mopub.com/m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=170558df1b4537cf" "AppEngine-Google; (+http://code.google.com/appengine)"
# 85.210.102.67 - - [23/Mar/2011:15:57:34 -0700] "GET /m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=170558df1b4537cf HTTP/1.1" 200 2180 - "Mozilla/5.0 (Linux; U; Android 2.2; en-gb; HTC Desire Build/FRF91) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 0.1.0.2 - - [23/Mar/2011:15:57:34 -0700] "GET /m/req?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGOj6IAw HTTP/1.1" 200 126 "http://ads.mopub.com/m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=170558df1b4537cf" "AppEngine-Google; (+http://code.google.com/appengine)"
# 212.166.237.62 - - [23/Mar/2011:15:57:35 -0700] "GET /m/ad?v=3&udid=d9dfa12b07ed83850e8a1e1d4b924fe311c6c810&q=&id=agltb3B1Yi1pbmNyDAsSBFNpdGUYifQQDA HTTP/1.1" 200 32851 - "GaiaLite/4.4 (iPhone; U; CPU iPhone OS 4.0.1 like Mac OS X; es_ES),gzip(gfe),gzip(gfe),gzip(gfe)"
# 85.210.102.67 - - [23/Mar/2011:15:57:35 -0700] "GET /m/imp?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGOj6IAw&udid=170558df1b4537cf HTTP/1.1" 200 146 "http://ads.mopub.com/" "Mozilla/5.0 (Linux; U; Android 2.2; en-gb; HTC Desire Build/FRF91) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 212.166.237.61 - - [23/Mar/2011:15:57:37 -0700] "GET /m/imp?id=agltb3B1Yi1pbmNyDAsSBFNpdGUYifQQDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGOGPGgw&udid=d9dfa12b07ed83850e8a1e1d4b924fe311c6c810 HTTP/1.1" 200 146 "http://ads.mopub.com/m/ad?v=3&udid=d9dfa12b07ed83850e8a1e1d4b924fe311c6c810&q=&id=agltb3B1Yi1pbmNyDAsSBFNpdGUYifQQDA" "Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_0_1 like Mac OS X; es-es) AppleWebKit/532.9 (KHTML, like Gecko) Mobile/8A306,gzip(gfe),gzip(gfe),gzip(gfe)"
# 0.1.0.2 - - [23/Mar/2011:15:57:37 -0700] "GET /m/req?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGJmSIQw HTTP/1.1" 200 126 "http://ads.mopub.com/m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=1c5bc259772be5cc" "AppEngine-Google; (+http://code.google.com/appengine)"
# 0.1.0.2 - - [23/Mar/2011:15:57:38 -0700] "GET /m/req?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGOj6IAw HTTP/1.1" 200 126 "http://ads.mopub.com/m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=9774d56d682e549c" "AppEngine-Google; (+http://code.google.com/appengine)"
# 208.54.40.65 - - [23/Mar/2011:15:57:38 -0700] "GET /m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=1c5bc259772be5cc HTTP/1.1" 200 2270 - "Mozilla/5.0 (Linux; U; Android 2.2; en-us; T-Mobile G2 Build/FRF91) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 208.54.40.49 - - [23/Mar/2011:15:57:39 -0700] "GET /m/imp?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGJmSIQw&udid=1c5bc259772be5cc HTTP/1.1" 200 146 "http://ads.mopub.com/" "Mozilla/5.0 (Linux; U; Android 2.2; en-us; T-Mobile G2 Build/FRF91) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 95.250.176.73 - - [23/Mar/2011:15:57:39 -0700] "GET /m/ad?v=2&id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&udid=9774d56d682e549c HTTP/1.1" 200 2178 - "Mozilla/5.0 (Linux; U; Android 2.2; it-it; Ideos Build/B827SP01) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
# 95.250.176.73 - - [23/Mar/2011:15:57:40 -0700] "GET /m/imp?id=agltb3B1Yi1pbmNyDAsSBFNpdGUY1NsgDA&cid=agltb3B1Yi1pbmNyEAsSCENyZWF0aXZlGOj6IAw&udid=9774d56d682e549c HTTP/1.1" 200 146 "http://ads.mopub.com/" "Mozilla/5.0 (Linux; U; Android 2.2; it-it; Ideos Build/B827SP01) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1,gzip(gfe),gzip(gfe),gzip(gfe)"
import datetime
import random
import uuid

from reporting.models import Pacific_tzinfo

udids = [uuid.uuid4() for i in range(100)]
adunits = ["adunit%s"%i for i in range(2)]
creatives = ["creative%s"%i for i in range(10)]
ips = ["%i.%i.%i.%i"%(random.randint(0,255),random.randint(0,255),random.randint(0,255),random.randint(0,255)) for i in range(100)]
user_agents = ["GaiaLite/4.4 (iPhone; U; CPU iPhone OS 4.0.1 like Mac OS X; es_ES),gzip(gfe),gzip(gfe),gzip(gfe)"]
actions = ["ad","imp","req","aclk"]
excludes = ["","exclude=iAd"]
dates = [datetime.datetime(2011,04,02,22,10,tzinfo=Pacific_tzinfo()),
         datetime.datetime(2011,04,02,22,20,tzinfo=Pacific_tzinfo()),
         datetime.datetime(2011,04,02,23,10,tzinfo=Pacific_tzinfo()),
         datetime.datetime(2011,04,03,00,10,tzinfo=Pacific_tzinfo()),
         datetime.datetime(2011,04,03,01,10,tzinfo=Pacific_tzinfo()),]

AD_LOG_FORMAT = '%(ip)s - - [%(date)s] "GET /m/%(action)s?id=%(adunit)s&udid=%(udid)s&%(exclude)s HTTP/1.1" 200 146 "http://ads.mopub.com/" "%(user_agent)s"'
ALL_LOG_FORMAT = '%(ip)s - - [%(date)s] "GET /m/%(action)s?id=%(adunit)s&cid=%(creative)s&udid=%(udid)s HTTP/1.1" 200 146 "http://ads.mopub.com/" "%(user_agent)s"'

def pick_random(param):
    # grabs the appropriate param list 
    l = globals()[param+"s"]
    length = len(l)
    index = random.randint(0,length-1)
    return l[index]


f = open('sample_log.txt','w')

count_dict = {}
def update_count_dict(action,adunit,creative,date_obj,udid,**kwargs):
    if action == "ad":
        action = "req"
        creative = ""
    
    key = "%s:%s:%s"%(adunit,creative,date_obj.strftime("%Y%m%d%H%M"))

    if not key in count_dict:
        count_dict[key] = dict(req=0,imp=0,aclk=0)    
    count_dict[key][action] += 1

for i in range(20):
    params = ["ip","date","action","adunit","creative","udid","user_agent","exclude"]
    d = dict()
    for param in params:
        value = pick_random(param)
        if param == "date":
            d.update(date_obj=value)
            value = value.strftime("%d/%b/%Y:%H:%M:%S %z")
        d.update({param:value})
    if d["action"] == "ad":    
        f.write(AD_LOG_FORMAT%d+'\n')
    else:
        f.write(ALL_LOG_FORMAT%d+'\n')    
        
    if d["exclude"]:
        print 'continuing'
        continue
    print 'updating'    
        

    update_count_dict(**d)    
f.close()

f = open('sample_log_counts.txt','w')
for key in count_dict:
    f.write("%s %s\n"%([count_dict[key].get('req',0),count_dict[key].get('imp',0),count_dict[key].get('aclk',0)],key))
f.close()