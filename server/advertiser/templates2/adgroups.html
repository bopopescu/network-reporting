{% extends 'advertiser/base.html' %}
{% load filters %}
{% block navLinks %}
            <li><a href="{% url publisher_index %}">Dashboard</a></li>
            <li class="active"><a href="{% url advertiser_campaign %}">Campaigns</a></li>{% endblock navLinks %}
{% block pageTitle %}<h1>{% ifequal account.status 'step4' %}Step 4: Set up an ad campaign{% else %}Campaigns{% endifequal %}</h1>{% endblock pageTitle %}
{% block titleBarRight %}{% ifequal account.status 'step4' %}            <div class="stepProgress"> 
              <span class="stepProgress-step">Step 1: Add app</span> 
              <span class="ui-icon ui-icon-arrow-1-e"></span> 
              <span class="stepProgress-step">Step 2: Integrate</span> 
              <span class="ui-icon ui-icon-arrow-1-e"></span> 
              <span class="stepProgress-step">Step 3: Ad networks</span> 
              <span class="ui-icon ui-icon-arrow-1-e"></span> 
              <span class="stepProgress-step stepProgress-active">Step 4: Ad campaigns</span> 
            </div>{% endifequal %}{% endblock titleBarRight %}
{% block messageCenter %}{% endblock messageCenter %}


{% block content %}{% ifequal account.status "step4" %}
          <div class="alertMessage">
            Finally, you will need to set up at least one ad campaign to serve into your inventory.  A <strong>Guaranteed</strong> ad campaign is typically a direct sold ad campaign.  <strong>Promotional</strong> campaigns are for house ads like an upsell.  A <strong>Network</strong> ad is an ad served from a ad network like AdMob.
          </div>
{% endifequal %}
          <div class="separated">
            <section class="offset nomargin" id="dashboard-stats">
              <div class="stats">
                <table class="stats-breakdown">
                  <tbody>
                    <tr class="active" id="stats-breakdown-revenue">
                      <td class="stats-breakdown-value"><span class="inner">{{totals.revenue|currency}}</span></td>
                      <th class="stats-breakdown-name"><span class="inner">Revenue</span></th>
                    </tr>
                    <tr id="stats-breakdown-impressions">
                      <td class="stats-breakdown-value"><span class="inner">{{totals.impression_count|withsep}}</span></td>
                      <th class="stats-breakdown-name"><span class="inner">Impressions</span></th>
                    </tr>
                    <tr id="stats-breakdown-clicks">
                      <td class="stats-breakdown-value"><span class="inner">{{totals.click_count|withsep}}</span></td>
                      <th class="stats-breakdown-name"><span class="inner">Clicks</span></th>
                    </tr>
                    <tr id="stats-breakdown-users">
                      <td class="stats-breakdown-value"><span class="inner">{{totals.unique_user_count|withsep}}</span></td>
                      <th class="stats-breakdown-name"><span class="inner">Users</span></th>
                    </tr>
                  </tbody>
                </table>
                <div class="chart chart-loading stats-chart" id="dashboard-stats-chart">
                  <div class="chart-loading-text">Loading ...</div>
                  <div class="chart-error-text">Could not load chart</div>
                  <script type="text/javascript">
                    // chart data
                    mopub.dashboardStatsChartData = {
                      //pointStart: 1294963200000,
                      pointStart: Date.UTC({{start_date.year}},{{start_date.month|add:"-1"}},{{start_date.day}}),
                      pointInterval: 86400000,
                      'revenue': [{% for a in adgroups %}
                        { '{{a.name|safe|addslashes}}': [{% for stat in a.all_stats %}{{stat.revenue}}{% if not forloop.last %},{% endif %} {% endfor %}] }{% if not forloop.last %},{% endif %}{% endfor %}
                      ],
                      'impressions': [{% for a in adgroups %}
                        { '{{a.name|safe|addslashes}}': [{% for stat in a.all_stats %}{{stat.impression_count}}{% if not forloop.last %},{% endif %} {% endfor %}] }{% if not forloop.last %},{% endif %}{% endfor %}
                      ],
                      'clicks': [{% for a in adgroups %}
                        { '{{a.name|safe|addslashes}}': [{% for stat in a.all_stats %}{{stat.click_count}}{% if not forloop.last %},{% endif %} {% endfor %}] }{% if not forloop.last %},{% endif %}{% endfor %}
                      ],
                      'users': [{% for a in adgroups %}
                        { '{{a.name|safe|addslashes}}': [{% for stat in a.all_stats %}{{stat.unique_user_count}}{% if not forloop.last %},{% endif %} {% endfor %}] }{% if not forloop.last %},{% endif %}{% endfor %}
                      ]
                    };
                  </script>
                </div>
              </div>
              <div class="clear"></div>
            </section>
          </div>
          <section id="dashboard-campaigns">
            <div class="buttonBank buttonBank-right">
              <a class="button" id="advertisers-addCampaign" href="{% url advertiser_campaign_create %}">Add a campaign</a>
            </div>
            <form method="post" action="{% url advertiser_bid_pause %}" id="campaignForm">
              <input type="hidden" name="action" id="action"/>

              <h2>Guaranteed</h2>
              <table class="dataTable campaignData-main">
                <thead>
                  <tr>
                    <th class="campaignData-icon"></th>
                    <th class="dataTable-name">Name</th>
                    <th class="dataTable-data numeric">CPM</th>
                    <th class="dataTable-data numeric">Status</th>
                    <th class="dataTable-data numeric">Impressions</th>
                    <th class="dataTable-data numeric">Clicks</th>
                    <th class="dataTable-data numeric">CTR</th>
                    <th class="dataTable-data numeric">Conv</th>
                    <th class="dataTable-data numeric">CPA</th>
                  </tr>
                </thead>
                <tbody>
              	  {% for c in gtee %}
                  <tr class="{% cycle 'campaignData' 'campaignData campaignData-alt' %}" id="campaigns-guaranteed-{{forloop.counter0}}">
                    <th class="campaignData-icon">
                      <input type="checkbox" name="id" value="{{c.key}}"/>
                      {% if c.deleted %}<img src="/images/deleted.gif" height=9 width=9></img>{% endif %}
                      {% if c.active and not c.deleted %}<img src="/images/active.gif" height=9 width=9></img>{% endif %}
                      {% if not c.active and not c.deleted %}<img src="/images/paused.gif" height=9 width=9></img>{% endif %}
                    </th> 
                    <th class="dataTable-name">
						<a href="{% url advertiser_adgroup_show adgroup_key=c.key %}">{{c.name}}</a><br/>
						<span class="muted">
							{% if c.start_date and c.end_date %}
								{{c.start_date|format_date_compact}}-{{c.end_date|format_date_compact}}.
							{% endif %} {% if c.start_date and not c.end_date %}
								Starts {{c.start_date|format_date_compact}}.
							{% endif %} {% if not c.start_date and c.end_date %}
								Ends {{c.start_date|format_date_compact}}.
							{% endif %} {% if not c.start_date and not c.end_date %}
								No schedule.
							{% endif %}
							{% if c.budget %}{{c.budget|currency}} daily budget.{% else %}Unlimited budget.{% endif %}
						</span>
					</th>
                    <td class="dataTable-data numeric">{{c.bid|currency}}</td>
                    <td class="dataTable-data numeric">{{c|campaign_status}}</td>
                    <td class="dataTable-data numeric">{{c.stats.impression_count|withsep}}</td>
                    <td class="dataTable-data numeric">{{c.stats.click_count|withsep}}</td>
                    <td class="dataTable-data numeric">{{c.stats.ctr|percentage|withsep}}</td>
                    <td class="dataTable-data numeric">{{c.stats.conversion_count|withsep}} ({{c.stats.conv_rate|percentage}})</td>
                    <td class="dataTable-data numeric">{{c.stats.cpa|currency}}</td>
                  </tr>
              	  {% empty %}
				  <tr class="campaignData">
                    <th class="campaignData-icon"></th>
                    <th class="dataTable-name"><span class="muted">None</span></th>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
                  </tr>
              	  {% endfor %}
				</tbody>
			  </table>

			  <h2>Promotional</h2>
              <table class="dataTable campaignData-main">
                <thead>
                  <tr>
                    <th class="campaignData-icon"></th>
                    <th class="dataTable-name">Name</th>
                    <th class="dataTable-data numeric">CPM</th>
                    <th class="dataTable-data numeric">Status</th>
                    <th class="dataTable-data numeric">Impressions</th>
                    <th class="dataTable-data numeric">Clicks</th>
                    <th class="dataTable-data numeric">CTR</th>
                    <th class="dataTable-data numeric">Conv</th>
                    <th class="dataTable-data numeric">CPA</th>
                  </tr>
                </thead>
                <tbody>
              	  {% for c in promo %}
                  <tr class="{% cycle 'campaignData' 'campaignData campaignData-alt' %}" id="campaigns-promo-{{forloop.counter0}}">
                    <th class="campaignData-icon">
                      <input type="checkbox" name="id" value="{{c.key}}"/>
                      {% if c.deleted %}<img src="/images/deleted.gif" height=9 width=9></img>{% endif %}
                      {% if c.active and not c.deleted %}<img src="/images/active.gif" height=9 width=9></img>{% endif %}
                      {% if not c.active and not c.deleted %}<img src="/images/paused.gif" height=9 width=9></img>{% endif %}
                    </th> 
                    <th class="dataTable-name">
						<a href="{% url advertiser_adgroup_show adgroup_key=c.key %}">{{c.name}}</a><br/>
						<span class="muted">
							{% if c.start_date and c.end_date %}
								{{c.start_date|format_date_compact}}-{{c.end_date|format_date_compact}}.
							{% endif %} {% if c.start_date and not c.end_date %}
								Starts {{c.start_date|format_date_compact}}.
							{% endif %} {% if not c.start_date and c.end_date %}
								Ends {{c.start_date|format_date_compact}}.
							{% endif %} {% if not c.start_date and not c.end_date %}
								No schedule.
							{% endif %}
							{% if c.budget %}{{c.budget|currency}} daily budget.{% else %}Unlimited budget.{% endif %}
						</span>
					</th>
                    <td class="dataTable-data numeric">{{c.bid|currency}}</td>
					<td class="dataTable-data numeric">{{c|campaign_status}}</td>
                    <td class="dataTable-data numeric">{{c.stats.impression_count|withsep}}</td>
                    <td class="dataTable-data numeric">{{c.stats.click_count|withsep}}</td>
                    <td class="dataTable-data numeric">{{c.stats.ctr|percentage|withsep}}</td>
                    <td class="dataTable-data numeric">{{c.stats.conversion_count|withsep}} ({{c.stats.conv_rate|percentage}})</td>
                    <td class="dataTable-data numeric">{{c.stats.cpa|currency}}</td>
                  </tr>
              	  {% empty %}
				  <tr class="campaignData">
                    <th class="campaignData-icon"></th>
                    <th class="dataTable-name"><span class="muted">None</span></th>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
                  </tr>
               	  {% endfor %}
				</tbody>
			  </table>
			
              <h2>Network</h2>
              <table class="dataTable campaignData-main">
                <thead>
                  <tr>
                    <th class="campaignData-icon"></th>
                    <th class="dataTable-name">Name</th>
                    <th class="dataTable-data numeric">eCPM</th>
                    <th class="dataTable-data numeric">Requests</th>
                    <th class="dataTable-data numeric">Impressions</th>
                    <th class="dataTable-data numeric">Clicks</th>
                    <th class="dataTable-data numeric">CTR</th>
                    <th class="dataTable-data numeric">&nbsp;</th>
                    <th class="dataTable-data numeric">&nbsp;</th>
                  </tr>
                </thead>
                <tbody>
              	  {% for c in network %}
                  <tr class="{% cycle 'campaignData' 'campaignData campaignData-alt' %}" id="campaigns-network-{{forloop.counter0}}">
                    <th class="campaignData-icon">
                      <input type="checkbox" name="id" value="{{c.key}}"/>
                      {% if c.deleted %}<img src="/images/deleted.gif" height=9 width=9></img>{% endif %}
                      {% if c.active and not c.deleted %}<img src="/images/active.gif" height=9 width=9></img>{% endif %}
                      {% if not c.active and not c.deleted %}<img src="/images/paused.gif" height=9 width=9></img>{% endif %}
                    </th> 
                    <th class="dataTable-name">
						<a href="{% url advertiser_adgroup_show adgroup_key=c.key %}">{{c.name}}</a><br/>
						<span class="muted">{{c.network_type}}</span>
					</th>
                    <td class="dataTable-data numeric">{{c.bid|currency}}</td>
                    <td class="dataTable-data numeric">{{c.stats.request_count|withsep}}</td>
                    <td class="dataTable-data numeric">{{c.stats.impression_count|withsep}}</td>
                    <td class="dataTable-data numeric">{{c.stats.click_count|withsep}}</td>
                    <td class="dataTable-data numeric">{{c.stats.ctr|percentage|withsep}}</td>
					<td class="dataTable-data numeric">&nbsp;</td>
					<td class="dataTable-data numeric">&nbsp;</td>
                  </tr>
              	  {% empty %}
				  <tr class="campaignData">
                    <th class="campaignData-icon"></th>
                    <th class="dataTable-name"><span class="muted">None</span></th>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
					<td class="dataTable-data numeric"></td>
                  </tr>
               	  {% endfor %}
				</tbody>
			  </table>
			
              <div class="form-submit-left"> 
                <span class="buttonWrap"><a class="button" id="campaignForm-pause">Pause</a>
                <a class="button" id="campaignForm-resume">Resume</a>
                <a class="button" id="campaignForm-delete">Delete</a></span> 
              </div> 
            </form> 
          </section>
{% endblock content %}
