{% extends "ad_network_base.html" %}
{% load filters %}

{% block adNetworkTitle %}
{% endblock %}

{% block innerContent %}

  <div style="padding-top:250px; text-align:center;">
    <h3 class="dataTable-title">
      Aggregate Stats for {{start_date|format_date_compact}} to {{end_date|format_date_compact}}
    </h3>
  </div>

  <ul class="pills">
    <li class="active"> <a href="#networks"> Sort by Network </a> </li>
    <li> <a href="#apps"> Sort by App </a> </li>
  </ul>

  {% comment %}
    <div class="alert-message block-message clearfix">
      We found <strong> 4 </strong> apps in AdMob that you haven't entered on MoPub.
      Would you like to add them automatically?
      <br />
      <div class="right">
        <a class="right primary btn"> Yes, add them now </a>
        <a class="right btn"> No, don't add </a>
      </div>
    </div>
  {% endcomment %}

  {% comment %}
    Make the table sorted by ad network. This one is hidden to start.
  {% endcomment %}
  <div class="tab-section active" id="networks">
    <table class="simpletable campaignData-main ad_network_table">
      <thead>
        <th class="dataTable-name"></th>
        <th class="dataTable-data numeric"> Revenue </th>
        <th class="dataTable-data numeric"> Attempts </th>
        <th class="dataTable-data numeric"> Impressions </th>
        <th class="dataTable-data numeric"> Fill Rate</th>
        <th class="dataTable-data numeric"> Clicks </th>
        <th class="dataTable-data numeric"> CTR </th>
      </thead>

      <tbody>
        {% for network_name, network in networks %}
          <tr class="top-row" id={{network.key}}>
            <td class="dataTable-data">
              <img src="/images/ad_network_logos/{{network_name}}-transparent.png"
              alt="{{network_name}}" width="75" height="25" />
            </td>
  {% comment %}
            {% if network.has_potential_errors %}
              <td class="dataTable-name">
                <br />
                (Couldn't collect stats. <a href="{% url ad_network_settings %}">Check the publisher id you entered for this network</a>.)
              </td>
            {% else %}
  {% endcomment %}
              <td class="dataTable-data numeric">{{ network.revenue|currency }} </td>
              <td class="dataTable-data numeric">{{ network.attempts|withsep }} </td>
              <td class="dataTable-data numeric">{{ network.impressions|withsep }} </td>
              <td class="dataTable-data numeric">{{ network.fill_rate|floatformat:2 }}% </td>
              <td class="dataTable-data numeric">{{ network.clicks|withsep }} </td>
              <td class="dataTable-data numeric">{{ network.ctr|floatformat:2 }}% </td>
          </tr>
          {% for app in network.data %}
          <tr class="sub-rows {% if not forloop.last %} add-border {% endif %} for-key-{{network.key}}">
              <td class="dataTable-name">
                <a href="{% url ad_network_app_detail app.key %}">{{app.name}}</a>
              </td>
              <td class="dataTable-data numeric">{{ app.revenue|currency }}</td>
              <td class="dataTable-data numeric">{{ app.attempts|withsep }}</td>
              <td class="dataTable-data numeric">{{ app.impressions|withsep }}</td>
              <td class="dataTable-data numeric">{{ app.fill_rate|floatformat:2 }}%</td>
              <td class="dataTable-data numeric">{{ app.clicks|withsep }}</td>
              <td class="dataTable-data numeric">{{ app.ctr|floatformat:2 }}%</td>
            </tr>
          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
  </div>


  {% comment %}
    Make the table sorted by app name. This table is active to start.
  {% endcomment %}
  <div class="tab-section" id="apps">
    <table class="simpletable campaignData-main ad_network_table">
      <thead>
        <th class="dataTable-name"></th>
        <th class="dataTable-data numeric"> Revenue </th>
        <th class="dataTable-data numeric"> Attempts </th>
        <th class="dataTable-data numeric"> Impressions </th>
        <th class="dataTable-data numeric"> Fill Rate </th>
        <th class="dataTable-data numeric"> Clicks </th>
        <th class="dataTable-data numeric"> CTR </th>
      </thead>

      <tbody>
        {% for app_name, app in apps %}
        <div class="section">
          <tr class="top-row" id="{{app.key}}">
            <td class="dataTable-name"> {{app_name}} </td>
            <td class="dataTable-data numeric">{{ app.revenue|currency }}</td>
            <td class="dataTable-data numeric">{{ app.attempts|withsep }}</td>
            <td class="dataTable-data numeric">{{ app.impressions|withsep }}</td>
            <td class="dataTable-data numeric">{{ app.fill_rate|floatformat:2 }}%</td>
            <td class="dataTable-data numeric">{{ app.clicks|withsep }}</td>
            <td class="dataTable-data numeric">{{ app.ctr|floatformat:2 }}%</td>
          </tr>
          {% for network in app.data %}
          <tr class="sub-rows {% if not forloop.last %} add-border {% endif %} for-key-{{app.key}}">
              <td class="dataTable-name">
                 <a href="{% url ad_network_app_detail network.key %}">{{network.name}} </a>
                 {% if network.has_potential_errors %}
                   <br />
                   (Couldn't collect stats. <a href="{% url ad_network_settings %}">Check the publisher id you entered for this network</a>.)
                 {% endif %}
              </td>
              <td class="dataTable-data numeric">{{ network.revenue|currency }}</td>
              <td class="dataTable-data numeric">{{ network.attempts|withsep }}</td>
              <td class="dataTable-data numeric">{{ network.impressions|withsep }}</td>
              <td class="dataTable-data numeric">{{ network.fill_rate|floatformat:2 }}%</td>
              <td class="dataTable-data numeric">{{ network.clicks|withsep }}</td>
              <td class="dataTable-data numeric">{{ network.ctr|floatformat:2 }}%</td>
            </tr>
          {% endfor %}
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>


  {% if networks_without_creds %}
    <div class="alert-message block-message warning">
      You've entered publisher information for the following ad networks,
      but we can't generate stats for you until you've entered your login
      credentials for the ad network.
      <br />
      <ul>
      {% for network in networks_without_creds %}
        <li> <strong>{{ network}}</strong>  (<a class="addcreds" href="#{{network}}"> Add Login Credentials </a>) </li>
      {% endfor %}
      </ul>
    {% endif %}
  </div>


  {% comment %}
  <div class="tab-section" id="networks">
    <table class="zebra-striped simpletable campaignData-main sortable">
      <thead>
        <th class="dataTable-name"> App </th>
        <th class="dataTable-name"> Ad Network </th>
        <th class="dataTable-data numeric"> Revenue </th>
        <th class="dataTable-data numeric"> Attempts </th>
        <th class="dataTable-data numeric"> Impressions </th>
        <th class="dataTable-data numeric"> Fill Rate</th>
        <th class="dataTable-data numeric"> Clicks </th>
        <th class="dataTable-data numeric"> CTR </th>
      </thead>

      <tbody>
        {% for key, mapper, stats in aggregate_stats_list %}
          <tr>
            <td class="dataTable-name"><a href='/ad_network_reports/app_view/{{key}}'>{{mapper.application.name}}</a></td>
            <td class="dataTable-name">{{mapper.ad_network_name}}</td>
            <td class="dataTable-data numeric">{{ stats.revenue|currency }}</td>
            <td class="dataTable-data numeric">{{stats.attempts|withsep }}</td>
            <td class="dataTable-data numeric">{{stats.impressions|withsep }}</td>
            <td class="dataTable-data numeric">{{stats.fill_rate|percentage }}</td>
            <td class="dataTable-data numeric">{{stats.clicks|withsep }}</td>
            <td class="dataTable-data numeric">{{stats.ctr|percentage }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% endcomment %}

    <a class="right btn" href="/ad_network_reports/add">Add more network credentials</a>
{% endblock innerContent %}



{% block appendedContent %}

  <div class="hidden" id="credential-form">
    <form id="loginCredentials">
      <div id="error"> {{error}} </div>
      <dl class="formFields clearfix" style="width: 350px;">
        <div class="hidden">
        <dt> Ad Network </dt>
        <dd>
          <select name="ad_network_name" id="ad_network_selector">
            {% for network in ad_network_names %}
              <option value="{{network}}"> {{network}} </option>
            {% endfor %}
          </select>
        </dd>
        </div>

          {% for form in forms %}

            <div id="{{form.ad_network}}-fields" class="network_form">

              {% ifequal form.ad_network "inmobi" %}
                <dt> InMobi Access ID </dt>
                <dd>
                  <<input type="" name="" value="" /> type="text" name="{{form.ad_network}}-username" id="id_username" class=" input-text" value=""> {{form.username.errors}}
                  <a href="#" class="whatsthis" id="inmobi-access-helpLink"> What's This? </a>
                </dd>

                <dt> InMobi Secret Key </dt>
                <dd>
                  <<input type="" name="" value="" /> type="password" name="{{form.ad_network}}-password"  id="id_password" class=" input-text" value="">  {{form.password.errors}}
                  <a href="#" class="whatsthis" id="inmobi-secret-helpLink"> What's This? </a>
                </dd>

              {% else %}
                <dt> Username </dt>
                <dd> <input type="text" name="{{form.ad_network}}-username" id="id_username" class=" input-text" value=""> {{form.username.errors}}</dd>

                <dt> Password</dt>
                <dd> <input type="password" name="{{form.ad_network}}-password"  id="id_password" class=" input-text" value="">  {{form.password.errors}}</dd>
              {% endifequal %}


          {% if form.ad_network == "admob" %}
            <dt> Client ID </dt>
            <dd> {{form.client_key}} </dd>
          {% endif %}


          <dt><input name="email" type="checkbox" /> </dt>
          <dd> Send me daily emails with my network stats </dd>

        </div>
      {% endfor %}

      <input class="right btn" type="submit" value="Submit" />

  </div>

{% endblock appendedContent %}


{% block extraScripts %}
  {{ block.super }}
  <script type="text/javascript" src="/js/mopub-advertiser.js?v=46"></script>
  <script>
    $(function () {
        mopub.Advertiser.initializeAdReportsIndex();
        mopub.Advertiser.initializeCredentialsPage();
    });
  </script>
{% endblock extraScripts %}
