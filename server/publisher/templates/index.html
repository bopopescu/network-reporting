{% extends 'publisher/base.html' %}
{% load filters %}
{% block navLinks %}
            <li class="active"><a href="{% url publisher_index %}">Dashboard</a></li>
            <li><a href="{% url advertiser_campaign %}">Campaigns</a></li>
            <li><a href="{% url reports_index %}">Reports</a></li>
{% endblock navLinks %}
{% block messageCenter %}{% endblock messageCenter %}

{% block titleBarRight %}
<span class="titlebar-link">
  <a class="linkIcon" href="{% url publisher_index_geo %}">Performance by region <span class="ui-icon ui-icon-triangle-1-e"></span></a>
</span>
{% endblock titleBarRight %}

{% block content %}
<div id="ajaxFailure" style="display:none">
    <a href="#" id="ajaxDismiss"><img src="../images/icons/199_16x16.png"></img></a>
    There was a problem retrieving data for some of your apps / sites.
    <a href="#" id="ajaxRetry"><img src="../images/icons/92_16x16.png"></img> <strong>Retry</strong></a>
</div>
{% ifequal account.status "step3" %}
          <div class="alertMessage">
            The next step is to set up your ad networks.  Visit your <a href="{% url account_index %}">Account</a> page to enable your ad networks.
          </div>
{% endifequal %}
          <section class="offset nomargin" id="dashboard-stats">
            <h3 class="stats-chart-title">Realtime Stats for {{start_date|format_date_compact}} to {{end_date|format_date_compact}}</h3>
            <div class="stats">
              <div class="stats-breakdown">
                <table>
                  <tbody>
                    <tr class="active" id="stats-breakdown-requests">
                      <td class="stats-breakdown-value today"><span class="inner">{{today.request_count|withsep}}</span></td>
                      <td class="stats-breakdown-value yesterday"><span class="inner">{{yesterday.request_count|withsep}}</span></td>
                      <td class="stats-breakdown-value all"><span class="inner">{{totals.request_count|withsep}}</span></td>
                      <th class="stats-breakdown-name"><span class="inner">Requests</span></th>
                    </tr>
                    <tr id="stats-breakdown-impressions">
                      <td class="stats-breakdown-value today"><span class="inner">{{today.impression_count|withsep}}</span></td>
                      <td class="stats-breakdown-value yesterday"><span class="inner">{{yesterday.impression_count|withsep}}</span></td>
                      <td class="stats-breakdown-value all"><span class="inner">{{totals.impression_count|withsep}}</span></td>
                      <th class="stats-breakdown-name"><span class="inner">Impressions</span></th>
                    </tr>
                    <tr id="stats-breakdown-clicks">
                        <td class="stats-breakdown-value today"><span class="inner"><span class="muted unbold">({{today.ctr|percentage}})</span> {{today.click_count|withsep}}</span></td>
                        <td class="stats-breakdown-value yesterday"><span class="inner"><span class="muted unbold">({{yesterday.ctr|percentage}})</span> {{yesterday.click_count|withsep}}</span></td>
                        <td class="stats-breakdown-value all"><span class="inner"><span class="muted unbold">({{totals.ctr|percentage}})</span> {{totals.click_count|withsep}}</span></td>
                        <th class="stats-breakdown-name"><span class="inner">Clicks</span></th>
                    </tr>
                    <tr id="stats-breakdown-users">
                      <td class="stats-breakdown-value today"><span class="inner">{{today.user_count|withsep}}</span></td>
                      <td class="stats-breakdown-value yesterday"><span class="inner">{{yesterday.user_count|withsep}}</span></td>
                      <td class="stats-breakdown-value all"><span class="inner">{{totals.user_count|withsep}}</span></td>
                      <th class="stats-breakdown-name"><span class="inner">Users</span></th>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="stats-breakdown-buttons">
                <span class="buttonset button-small" id="stats-breakdown-dateOptions">
                  <input type="radio" name="stats-breakdown-dateOptions-option" value="today" id="stats-breakdown-dateOptions-option-0" checked="checked"/>
                  <label for="stats-breakdown-dateOptions-option-0">Today</label>
                  <input type="radio" name="stats-breakdown-dateOptions-option" value="yesterday" id="stats-breakdown-dateOptions-option-1"/>
                  <label for="stats-breakdown-dateOptions-option-1">Yesterday</label>
                  <input type="radio" name="stats-breakdown-dateOptions-option" value="all" id="stats-breakdown-dateOptions-option-2"/>
                  <label for="stats-breakdown-dateOptions-option-2">All</label>
                </span>
              </div>
              <div class="chart stats-chart" id="dashboard-stats-chart">
              </div>
            </div>
            <div class="clear"></div>
          </section>

          <div class="clear"></div>

          <section id="dashboard-apps">
            <div class="buttonBank buttonBank-right">
              <a class="button" id="dashboard-apps-addAppButton" href="{% url publisher_app_create %}">Add an app</a>
            </div>
            <h2>Apps and sites</h2>

            <div class="appData-columnHeaders">
              <table class="dataTable" id="dashboard-apps-columnHeaders" width="100%">
                <thead>
                  <tr>
                    <th class="appData-icon"></th>
                    <th class="dataTable-name"></th>
                    <th class="dataTable-data numeric">Requests</th>
                    <th class="dataTable-data numeric">Impressions</th>
                    <th class="dataTable-data numeric">Fillrate</th>
                    <th class="dataTable-data numeric">Clicks</th>
                    <th class="dataTable-data numeric">CTR</th>
                  </tr>
                </thead>
              </table>
            </div>
            {% for a in apps %}
            <div class="{% cycle 'appData' 'appData appData-alt' %}" id="appData-{{a.key}}">
              <table class="dataTable appData-main" id="dashboard-app-{{forloop.counter0}}-main">
                <tbody>
                  <tr class="app-row" id="{{a.key}}">
                    <td class="appData-icon"><a href="{% url publisher_app_show app_key=a.key %}"><img src="{% if a.icon_url %}{{a.icon_url}}{% else %}/placeholders/image.gif{% endif %}" alt="Icon" width="45" height="45" /></a></td>
                    <th class="dataTable-name">
                        <span class="inner">
                            <a href="{% url publisher_app_show app_key=a.key %}">{{a.name}}</a>
                            <span class="muted unbold">({% ifequal a.app_type "iphone" %}iOS{% endifequal %}{% ifequal a.app_type "android" %}Android{% endifequal %}{% ifequal a.app_type "mweb" %}Mobile Web{% endifequal %})</span>
                            <img id="{{a.key}}-img" class="loading-img" style="display:none;" src="../images/icons-custom/spinner-12.gif"></img>
                        </span>
                    </th>
                    <td class="dataTable-data numeric req">--</td>
                    <td class="dataTable-data numeric imp">--</td>
                    <td class="dataTable-data numeric fill">--</td>
                    <td class="dataTable-data numeric clk">--</td>
                    <td class="dataTable-data numeric ctr">--</td>
                  </tr>
                </tbody>
              </table>
              <div class="appData-details" id="dashboard-app-{{forloop.counter0}}-details">
                <div class="appData-details-inner show">
                  <table class="dataTable">
                    <tbody>
                      {% for au in a.adunits %}
                      <tr class="adunit-row incomplete" id="{{au.key}}">
                        <th class="dataTable-name"><span class="inner"><a href="{% url publisher_adunit_show adunit_key=au.key %}">{{au.name}}</a><div class="appData-id muted hidden">Ad Unit ID: {{au.key}}</div></span></th>
                        <td class="dataTable-data numeric req">--</td>
                        <td class="dataTable-data numeric imp">--</td>
                        <td class="dataTable-data numeric fill">--</td>
                        <td class="dataTable-data numeric clk">--</td>
                        <td class="dataTable-data numeric ctr">--</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          {% endfor %}</section>{% endblock content %}

{% block extraScripts %}
<script>
    var mopub = mopub || {};
    $(function() {
        mopub.isDashboardPage = true;
        mopub.graphStartDate = Date.UTC({{start_date.year}},
              {{start_date.month|add:"-1"}},
              {{start_date.day}});
        mopub.accountStats = {{account_stats|safe}};
    });
</script>
<script src="/js/mopub-dashboard.js?v=34"></script>
{% endblock %}
