{% extends "ad_network_base.html" %}
{% load filters %}

{% block adNetworkTitle %}
{% endblock %}


{% block innerContent %}

  <div style="padding-top:250px; text-align:center;">
    <h3 class="dataTable-title">
      Aggregate Stats for {{start_date|format_date_compact}} to {{end_date|format_date_compact}}
    </h3>
  </div>

  <ul class="pills">
    <li class="active"> <a href="#apps"> Sort by App </a> </li>
    <li> <a href="#networks"> Sort by Network </a> </li>
  </ul>


  {% comment %}
    Make the table sorted by app name. This table is active to start.
  {% endcomment %}
  <div class="active tab-section" id="apps">
    <table class="simpletable campaignData-main ad_network_table">
      <thead>
        <th class="dataTable-name"></th>
        <th class="dataTable-data numeric"> Revenue </th>
        <th class="dataTable-data numeric"> Attempts </th>
        <th class="dataTable-data numeric"> Impressions </th>
        <th class="dataTable-data numeric"> Fill Rate </th>
        <th class="dataTable-data numeric"> Clicks </th>
        <th class="dataTable-data numeric"> CTR </th>
      </thead>

      <tbody>
        {% for app_name, app in apps.items %}
          <tr class="app-row">
            <td class="dataTable-name"><a href="{% url view_ad_network_app_report app.key %}"> {{app_name}} </a> </td>
            <td class="dataTable-data numeric">{{ app.revenue|currency }}</td>
            <td class="dataTable-data numeric">{{ app.attempts|withsep }}</td>
            <td class="dataTable-data numeric">{{ app.impressions|withsep }}</td>
            <td class="dataTable-data numeric">{{ app.fill_rate|percentage }}</td>
            <td class="dataTable-data numeric">{{ app.clicks|withsep }}</td>
            <td class="dataTable-data numeric">{{ app.ctr|percentage }}</td>
          </tr>
          {% for network in app.networks %}
            <tr class="network-row">
              <td class="dataTable-name">{{network.name}}</td>
              <td class="dataTable-data numeric">{{ network.revenue|currency }}</td>
              <td class="dataTable-data numeric">{{ network.attempts|withsep }}</td>
              <td class="dataTable-data numeric">{{ network.impressions|withsep }}</td>
              <td class="dataTable-data numeric">{{ network.fill_rate|percentage }}</td>
              <td class="dataTable-data numeric">{{ network.clicks|withsep }}</td>
              <td class="dataTable-data numeric">{{ network.ctr|percentage }}</td>
            </tr>
          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
  </div>


  {% comment %}
    Make the table sorted by ad network. This one is hidden to start.
  {% endcomment %}
  <div class="tab-section" id="networks">
    <table class="simpletable campaignData-main ad_network_table">
      <thead>
        <th class="dataTable-name"></th>
        <th class="dataTable-data numeric"> Revenue </th>
        <th class="dataTable-data numeric"> Attempts </th>
        <th class="dataTable-data numeric"> Impressions </th>
        <th class="dataTable-data numeric"> Fill Rate</th>
        <th class="dataTable-data numeric"> Clicks </th>
        <th class="dataTable-data numeric"> CTR </th>
      </thead>

      <tbody>
        {% for network_name, network in networks.items %}
          <tr class="app-row">
            <td class="dataTable-name"> {{network_name}} </td>
            <td class="dataTable-data numeric">{{ network.revenue|currency }} </td>
            <td class="dataTable-data numeric">{{ network.attempts|withsep }} </td>
            <td class="dataTable-data numeric">{{ network.impressions|withsep }} </td>
            <td class="dataTable-data numeric">{{ network.fill_rate|percentage }} </td>
            <td class="dataTable-data numeric">{{ network.clicks|withsep }} </td>
            <td class="dataTable-data numeric">{{ network.ctr|percentage }} </td>
          </tr>
          {% for app in network.apps %}
            <tr class="network-row">
              <td class="dataTable-name">{{app.name}}</td>
              <td class="dataTable-data numeric">{{ app.revenue|currency }}</td>
              <td class="dataTable-data numeric">{{ app.attempts|withsep }}</td>
              <td class="dataTable-data numeric">{{ app.impressions|withsep }}</td>
              <td class="dataTable-data numeric">{{ app.fill_rate|percentage }}</td>
              <td class="dataTable-data numeric">{{ app.clicks|withsep }}</td>
              <td class="dataTable-data numeric">{{ app.ctr|percentage }}</td>
            </tr>
          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
  </div>



  {% comment %}
  <div class="tab-section" id="networks">
    <table class="zebra-striped simpletable campaignData-main sortable">
      <thead>
        <th class="dataTable-name"> App </th>
        <th class="dataTable-name"> Ad Network </th>
        <th class="dataTable-data numeric"> Revenue </th>
        <th class="dataTable-data numeric"> Attempts </th>
        <th class="dataTable-data numeric"> Impressions </th>
        <th class="dataTable-data numeric"> Fill Rate</th>
        <th class="dataTable-data numeric"> Clicks </th>
        <th class="dataTable-data numeric"> CTR </th>
      </thead>

      <tbody>
        {% for key, mapper, stats in aggregate_stats_list %}
          <tr>
            <td class="dataTable-name"><a href='/ad_network_reports/app_view/{{key}}'>{{mapper.application.name}}</a></td>
            <td class="dataTable-name">{{mapper.ad_network_name}}</td>
            <td class="dataTable-data numeric">{{ stats.revenue|currency }}</td>
            <td class="dataTable-data numeric">{{stats.attempts|withsep }}</td>
            <td class="dataTable-data numeric">{{stats.impressions|withsep }}</td>
            <td class="dataTable-data numeric">{{stats.fill_rate|percentage }}</td>
            <td class="dataTable-data numeric">{{stats.clicks|withsep }}</td>
            <td class="dataTable-data numeric">{{stats.ctr|percentage }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% endcomment %}

    <a class="right btn" href={{add_credentials_url}}>Add more network credentials</a>
{% endblock innerContent %}
