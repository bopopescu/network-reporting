(function(e){function b(){e(".appData-details").each(function(){var j=e(this);var k=e(".appData-details-inner",j);var i=e(".appData-details-toggleButton",j);function m(){var n=e(".ui-button-text",i);if(n.length===0){n=i}return n}function h(){k.removeClass("hide");k.addClass("show");i.button("option",{icons:{primary:"ui-icon-triangle-1-n"}});m().text("Hide details")}function l(){k.removeClass("show");k.addClass("hide");i.button("option",{icons:{primary:"ui-icon-triangle-1-s"}});m().text("Show details")}if(k.hasClass("show")){h()}else{k.hide();l()}i.click(function(n){n.preventDefault();if(k.hasClass("show")){k.slideUp("fast");l()}else{k.slideDown("fast");h()}})})}function f(i){e("#creativeManagementForm-action").val(i);var h=e("#creativeManagementForm");h.find('input[name="key"]').remove();e("#advertiser-creativeData").find('input[name="creativeManagementForm-key"]:checked').each(function(j){e(this).val();e("<input></input>").attr("name","key").attr("type","hidden").val(e(this).val()).appendTo(h)});h.submit()}function d(){e('#creativeCreateForm input[name="ad_type"]').click(function(h){e(".adTypeDependent","#creativeCreateForm").hide();e(".adTypeDependent."+e(this).val(),"#creativeCreateForm").show()}).filter(":checked").click();e(".format-options").change(function(h){h.preventDefault();if(e(this).val()=="custom"){e(this).parents("form").find(".customc_only").show()}else{e(this).parents("form").find(".customc_only").hide()}if(e(this).val().search(/full/i)!=-1){e(this).parents().find(".full_only").show()}else{e(this).parents().find(".full_only").hide()}}).change();e("#creativeCreateForm-submit").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(h){h.preventDefault();e("#creativeCreateForm-loading").show();e("#creativeCreateForm").submit()});e("#creativeCreateForm-cancel").button().click(function(h){h.preventDefault();e("#advertiser-creativeAddForm").slideUp("fast",function(){e("#advertiser-adgroups-addCreativeButton").show()})});e('.creativeEditForm input[name="ad_type"]').click(function(i){var h=e(this).parents("form");e(".adTypeDependent",h).hide();e(".adTypeDependent."+e(this).val(),h).show()}).filter(":checked").click();e(".creativeFormAdvancedToggleButton").button("option",{icons:{primary:"ui-icon-triangle-1-s"}}).click(function(i){i.preventDefault();var h=e(this).parents("form").find(".creativeForm-advanced-options");if(h.is(":hidden")){h.slideDown("fast").removeClass("hidden");e(this).button("option",{icons:{primary:"ui-icon-triangle-1-n"}});e(".ui-button-text",this).text("Less Options")}else{h.slideUp("fast").addClass("hidden");e(this).button("option",{icons:{primary:"ui-icon-triangle-1-s"}});e(".ui-button-text",this).text("More Options")}});e(".creativeAddForm-url-helpLink").click(function(h){h.preventDefault();e("#creativeAddForm-url-helpContent").dialog({buttons:{Close:function(){e(this).dialog("close")}}})});e('#creativeAddForm input[name="creative_type"]').click(function(h){e("#creativeCreate-text_icon").hide();e("#creativeCreate-image").hide();e("#creativeCreate-html").hide();e("#creativeCreate-"+e(this).val()).show()}).filter(":checked").click();e("#creativeAddForm-cancel").button().click(function(h){h.preventDefault();e("#advertiser-creativeAddForm").slideUp("fast",function(){e("#advertiser-adgroups-addCreativeButton").show()})});e("#creativeCreateForm").ajaxForm({data:{ajax:true},dataType:"json",success:function(h){e("#creativeCreateForm-loading").hide();if(h.success){e("#creativeCreateForm-success").show();window.location.reload()}else{e.each(h.errors,function(i,l){e(".form-error-text","#creativeCreateForm").remove();var j=l[0];var k=e("<div>").append(l[1]).addClass("form-error-text");e("input[name="+j+"]","#creativeCreateForm").addClass("error").parent().append(k)});d();window.location.hash="";window.location.hash="advertiser-creativeAddForm";e("#campaignAdgroupForm-submit").button({label:"Continue",disabled:false})}},error:function(h,j,i){}});e(".creativeEditForm").each(function(j){var k=e(this);var h={data:{ajax:true},dataType:"json",success:function(l,m,n,i){i.find(".creativeEditForm-loading").hide();if(l.success){i.find(".creativeCreateForm-success").show();i.parent();i.find(".creativeCreateForm-success").hide();window.location.reload()}else{e(".form-error-text",i).remove();e.each(l.errors,function(o,r){var p=r[0];var q=e("<div>").append(r[1]).addClass("form-error-text");e("input[name="+p+"]",i).addClass("error").parent().append(q)});e('.creativeEditForm input[name="ad_type"]').click(function(o){e(this).parents("form").find(".adTypeDependent").hide().end().find("."+e(this).val()).show().end()}).filter(":checked").click();window.location.hash="";window.location.hash=i.prev("a").attr("name")}}};e(this).ajaxForm(h)});e(".creativeEditForm-submit").button().click(function(h){h.preventDefault();e(this).parents("form").find(".creativeEditForm-loading").show();e(this).parents("form").submit()});e(".creativeEditForm-cancel").button().click(function(h){h.preventDefault();e(this).parents(".advertiser-creativeEditForm").dialog("close")})}function c(){function h(){var i=e("#dashboard-stats .stats-breakdown .active");if(i.attr("id")=="stats-breakdown-ctr"){return"line"}else{return"area"}}e(".stats-breakdown tr").click(function(i){var j=e(this);if(!j.hasClass("active")){j.siblings().removeClass("active");j.addClass("active");e("#dashboard-stats-chart").fadeOut(100,function(){mopub.Chart.setupDashboardStatsChart(h());e(this).show()})}});mopub.Chart.setupDashboardStatsChart(h())}function a(i){var h=new AdUnitCollection();h.adgroup_key=i;h.url=function(){return"/api/adgroup/"+this.adgroup_key+"/adunits/"};h.bind("reset",function(j){j.each(function(l){var k=l.get("app_key");console.log(l);console.log(k);var m=new App({id:k});m.url=function(){return"/api/adgroup/"+i+"/apps/"+k};m.bind("change",function(o){var p=new AppView({model:m,el:"dashboard-app"});p.renderInline()});m.fetch();var n=new AdUnitView({model:l,el:"dashboard-app"});n.renderInline()})});h.fetch()}var g={initializeDirectSold:function(m){var i=m.gtee_adgroups_data,n=m.promo_adgroups_data,j=m.backfill_promo_adgroups_data,q=m.ajax_query_string;var k=new AdGroups(i);var l=new AdGroupsView({collection:k,el:"#gtee-adgroups",tables:{"High Priority":function(s){return s.get("level")=="high"},"Normal Priority":function(s){return s.get("level")=="normal"},"Low Priority":function(s){return s.get("level")=="low"}},title:"Guaranteed Campaigns",type:"gtee"});l.render();k.each(function(s){s.fetch({data:q})});var o=new AdGroups(n);var r=new AdGroupsView({collection:o,el:"#promo-adgroups",title:"Promotional Campaigns",type:"promo"});r.render();o.each(function(s){s.fetch({data:q})});var h=new AdGroups(j);var p=new AdGroupsView({collection:h,el:"#backfill-promo-adgroups",title:"Backfill Promotional Campaigns",type:"backfill_promo"});p.render();h.each(function(s){s.fetch({data:q})});e("#campaigns-appFilterOptions").selectmenu({style:"popup",maxHeight:300,width:184});e("#campaigns-filterOptions, #campaigns-appFilterOptions").change(function(){l.render();r.render();p.render()});e("#add_campaign_button").button({icons:{primary:"ui-icon-circle-plus"}});e.each(["pause","resume","activate","archive","delete"],function(s,t){e("#campaignForm-"+t).click(function(u){u.preventDefault();e("#campaignForm").find("#action").attr("value",t).end().submit()})})},initializeAdGroupDetail:function(j){var i=j.kind,h=j.adgroup_key;d();c();b();a(h);e("#campaign-status-options").change(function(k){var l=e(this).val();e("#fake-campaignForm").find("#action").attr("value",l).end().submit()});e("#campaign-status-options-menu").find("li").first().hide();e.each(["pause","resume","delete"],function(k,l){e("#creativeManagementForm-"+l).click(function(m){m.preventDefault();f(l)})});e(".creativeManagementForm-key").change(function(l){e('#creativeManagementForm input[name="key"]').remove();e(".creativeManagementForm-key:checked").each(function(m){e(this).val()});var k=e("#creativeManagementForm")});e(".advertiser-inLineCreativePreview").button({icons:{primary:"ui-icon-search"}}).click(function(o){o.preventDefault();var l=e(this).attr("id");var n=e("#"+l+"-preview-src").val();var m=parseInt(e("#"+l+"-preview iframe").attr("width"));var k=parseInt(e("#"+l+"-preview iframe").attr("height"));e("#"+l+"-preview iframe").attr("src",n);e("#"+l+"-preview").dialog({buttons:[{text:"Close",click:function(){e(this).dialog("close")}}],width:m+100,height:k+130})});e(".advertiser-inLineCreativeToggle").button({icons:{primary:"ui-icon-wrench"}}).click(function(l){l.preventDefault();var k=e(this).attr("id");var m=e("#"+k+"-edit");m.dialog({width:1000})});e("#add_campaign_button").button({icons:{primary:"ui-icon-circle-plus"}});e("#advertiser-adgroups-addCreativeButton").button({icons:{primary:"ui-icon-circle-plus"}}).click(function(k){k.preventDefault();var l=e("#advertiser-creativeAddForm");if(l.is(":hidden")){e("#advertiser-creativeAddForm").slideDown("fast")}else{e("#advertiser-creativeAddForm").slideUp("fast")}});e("#advertisers-addCampaign").button({icons:{primary:"ui-icon-circle-plus"}});e("#advertisers-adgroups-editAdGroupButton").button({icons:{primary:"ui-icon-wrench"}});e.each(["pause","resume","activate","archive","delete"],function(k,l){e("#campaignForm-"+l).click(function(m){m.preventDefault();e("#campaignForm").find("#action").attr("value",l).end().submit()})});e("#campaign-status-options-menu").find("li").first().hide();e("#advertiser-adgroups-exportSelect").change(function(k){k.preventDefault();var l=e(this).val();if(l!="exp"){e("#campaignExportForm").find("#campaignExportType").val(l).end().submit()}e(this).selectmenu("index",0)});e("#advertiser-adgroups-exportSelect-menu").find("li").first().hide();e("#device_targeting_False").click(function(){e("#target-by-device").slideUp()});e("#device_targeting_True").click(function(){e("#target-by-device").slideDown()});if(e("#device_targeting_True:checked").length===0){e("#target-by-device").hide()}if(e(".creativeData").length===0&&i!="network"){e("#chartWrapper").hide();e("#advertiser-creativeData").hide();e("#advertiser-adgroups-addCreativeButton").click()}}};window.CampaignsController=g})(this.jQuery);