{% extends 'publisher/base.html' %}
{% load filters %}
{% load elements %}

{% block pageTitle %}
  <h1>
    <a href="{% url app_index %}">Apps</a> / {{app.name}}
  </h1>
{% endblock pageTitle %}

{% block content %}
  <div id="dashboard-appEditForm" class="hidden" style="margin-bottom: 10px;">
    <a name="appForm" class="hidden">anchor</a>
    <form action="{% url publisher_app_update_ajax app_key=app.key %}"
          enctype='multipart/form-data'
          method="POST"
          accept-charset="utf-8"
          id="appForm"
          class="appEditForm">
      <fieldset id="appForm-details" class="alt">
        <div id="appForm-fragment">
          {{ app_form_fragment }}
        </div>
        <div class="form-submit">
          <span class="hidden" id="appEditForm-loading">
            <img src="/images/icons-custom/spinner-12.gif"/>
          </span>

          <a href="#" class="btn" id="appEditForm-cancel">
            Cancel
          </a>
          <a href="#" class="btn" id="appEditForm-submit">
            {% button_icon "ok" %}
            Save
          </a>
        </div>
      </fieldset>
    </form>
  </div>

  
  {% chart_placeholder start_date end_date %}
  <div id="dashboard-apps">

    <div class="right">
      <a class="btn" id="dashboard-apps-editAppButton" href="#">
        <i class="icon-pencil"></i>
        Edit app settings
      </a>
      <a class="btn" id="dashboard-apps-addAdUnitButton" href="#">
        <i class="icon-plus"></i>
        Add an Ad Unit
      </a>
    </div>
  </div>
    
    <h2>Ad units for {{ app.name }}</h2>


    {% comment %}
      Form/buttons for adding a new adunit
    {% endcomment %}

    <div id="dashboard-adunitAddForm" class="hidden">
      <form action="{% url publisher_adunit_update_ajax %}"
            method="POST"
            accept-charset="utf-8"
            id="adunitAddForm">
        <fieldset id="adunitForm-details" class="alt">
          <div id="adunitForm-fragment">
            {{ adunit_form_fragment }}
          </div>
          
          <div class="form-submit">
            <span class="hidden" id="adunitForm-loading">
              <img src="/images/loading2.gif"/>
            </span>
            <a href="#" class="btn" id="adunitAddForm-cancel">
              Cancel
            </a>
            <a href="#" class="btn" id="adunitAddForm-submit">
              {% button_icon "ok" %}
              Save
            </a>
          </div>
        </fieldset>
      </form>
  </div>

    {% comment %}
      Table containing each adunit for the app
    {% endcomment %}

    <div id="dashboard-apps">
      {% inventory_table app %}
    </div>

    <div class="divSpacer"></div>

    {% comment %}
      Tables containing targeting information for each campaign
      the app is in
    {% endcomment %}

    <div id="app-ad-sources">
      <h2>Ad sources for {{app.name}}</h2>
      <img src="/images/loading2.gif" style='margin-left:450px' />
    </div>

    <br />
    
    <div id="daily-counts">
      <h2>Daily Counts</h2>
      <img src="/images/loading2.gif" style='margin-left:450px' />
    </div>
    
    <div id="app-delete">
      <form method="post"
            id="dashboard-deleteForm"
            action="{% url publisher_delete_app app_key=app.key %}">
        <a href="#" id="dashboard-delete-link" class="right btn">
          {% button_icon "trash" %}
          Remove app from dashboard
        </a>
      </form>
      
      <div id="dashboard-delete-modal" class="hidden">
        <h2>Remove confirmation</h2>
        <p>Are you sure you want to remove {{app.name}} from the dashboard?</p>
      </div>
      
    </div>
  </div>
  
{% endblock content %}


{% block extraScripts %}
  
  {% include_template "chart" %}
  {% include_template "daily-counts" %}
  
  {% include_script "models/inventory" %}
  {% include_script "views/inventory" %}
  {% include_script "controllers/publisher" %}
  
  <script type="text/javascript">
    $(function() {
        DashboardController.initializeAppDetail({
            app_key: "{{ app.key }}",
            start_date: {{ start_date|js_date }}
        });
    });
  </script>

{% endblock extraScripts %}
