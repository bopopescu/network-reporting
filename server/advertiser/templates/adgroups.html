{% extends "advertiser/base.html" %}

{% load filters %}


{% block content %}
<script type="text/javascript">
function togglePaused() {
  $A($$('tr.paused')).each(Element.toggle);
  $('hide_button').toggle();
  $('show_button').toggle();
}
</script>
	<h3>
		Campaigns
		<div class="toolbar">
			<button onClick="location.href='{% url advertiser_campaign_create %}'" class="btn"><span><span>+ New Campaign</span></span></a></button>
		</div>
	</h3>
	<table class="rollups">
		<tr>
			<td class="rollup rollup_selected" onClick="show_graph_imp(this);"><b>Impressions</b><br/>{{today.impression_count|withsep}}</td>
			<td class="rollup" onClick="show_graph_clk(this);"><b>Clicks</b><br/>{{today.click_count|withsep}} ({{today.ctr|percentage}})</td>
			<td class="rollup" onClick="show_graph_rev(this);"><b>Revenue (est.)</b><br/>{{today.revenue|currency}}</td>
		</tr>
	</table>
	
	<img id='chart_img' src="{{chart_urls.imp}}" width=780 height=200 style="padding: 5px 0 10px 0;"/>

  <button onClick="togglePaused();return false;" class="btn"><span><span id="hide_button">Hide Paused</span><span id="show_button" style="display:none;">Show Paused</span></span></a></button>
  <select id='app_select' name="app" style="margin-left:10px;" onchange='var app=$("app_select").getValue();var param=(app)?"?app="+app:"";window.location="{% url advertiser_campaign %}"+param'>
    <option value="">All Apps</option>
    {% for a in all_apps %}
    <option value="{{a.key}}" {% ifequal app a.key|stringformat:"s" %}selected{% endifequal %}>{{a.name}}</option>
    {% endfor %}
  </select>
  {% if all_sites %}
  <select id="site_select" name="site" style="margin-left:10px;" onchange='var site=$("site_select").getValue();var param=(site)?"?site="+site:"?app="+$("app_select").getValue();window.location="{% url advertiser_campaign %}"+param'>
    <option value="">All Ad Units</option>
    {% for s in all_sites %}
    <option value="{{s.key}}" {% ifequal site s.key|stringformat:"s" %}selected{% endifequal %}>{{s.name}}</option>
    {% endfor %}
  </select>
  {% endif %}
  
  <br/>
  
	<form method="post" action="{% url advertiser_bid_pause %}">
		<input type="hidden" name="action"/>
		<h4>
			Guaranteed
		</h4>
		<table class="wide">
			<thead>
				<th width="25%">Campaign</th>
				<th width="75px">CPM</th>
				<th>Status</th>
				<th class="numeric">Impr.</th>
				<th class="numeric">Clicks</th>
				<th class="numeric">Revenue</th>
				<th class="numeric">Delivery%</th>
			</thead>
			{% for c in gtee %}
				<tr {%if not c.active %}class="paused"{% endif %}>
					<td><input type="checkbox" name="id" value="{{c.key}}"/> <a href="{% url advertiser_adgroup_show adgroup_key=c.key%}">{{c.name}}</a></td>
					<td>{{c.bid|currency}}</td>
					<td>
						{% if c.deleted %}
							<img src="/images/deleted.gif" width=9 height=9/>
						{% endif %}
						{% if c.active and not c.deleted %}
							<img src="/images/active.gif" width=9 height=9/>
						{% endif %}
						{% if not c.active and not c.deleted %}
							<img src="/images/paused.gif" width=9 height=9/>
						{% endif %}
					</td>
					<td class="numeric">{{c.stats.impression_count|withsep}}</td>
					<td class="numeric">{{c.stats.click_count|withsep}} ({{c.stats.ctr|percentage}})
					<td class="numeric">{{c.stats.revenue|currency}}</td>
					<td class="numeric">{{c.delivery|percentage}}</td>
				</tr>
			{% empty %}
				<tr><td>No campaigns.</td></tr>
			{% endfor %}
		</table>
	
		<h4>
			Promotional
		</h4>
		<table class="wide">
			<thead>
				<th width="25%">Campaign</th>
				<th width="75px">CPM</th>
				<th>Status</th>
				<th class="numeric">Impr.</th>
				<th class="numeric">Clicks</th>
				<th class="numeric">Delivery%</th>
			</thead>
			{% for c in promo %}
				<tr {%if not c.active %}class="paused"{% endif %}>
					<td><input type="checkbox" name="id" value="{{c.key}}"/> <a href="{% url advertiser_adgroup_show adgroup_key=c.key%}">{{c.name}}</a></td>
					<td>{{c.bid|currency}}</td>
					<td>
						{% if c.deleted %}
							<img src="/images/deleted.gif" width=9 height=9/>
						{% endif %}
						{% if c.active and not c.deleted %}
							<img src="/images/active.gif" width=9 height=9/>
						{% endif %}
						{% if not c.active and not c.deleted %}
							<img src="/images/paused.gif" width=9 height=9/>
						{% endif %}
					</td>
					<td class="numeric">{{c.stats.impression_count|withsep}}</td>
					<td class="numeric">{{c.stats.click_count|withsep}} ({{c.stats.ctr|percentage}})
					<td class="numeric">{{c.delivery|percentage}}</td>
				</tr>
			{% empty %}
				<tr><td>No campaigns.</td></tr>
			{% endfor %}
		</table>
	
		<h4>
			Network
		</h4>
		<table class="wide">
			<thead>
				<th width="25%">Campaign</th>
				<th width="75px">CPM</th>
				<th>Status</th>
				<th>Type</th>
				<th class="numeric">Req.</th>
				<th class="numeric">Impr.</th>
				<th class="numeric">Clicks</th>
				<th class="numeric">Revenue</th>
			</thead>
			{% for c in network %}
				<tr {%if not c.active %}class="paused"{% endif %}>
					<td><input type="checkbox" name="id" value="{{c.key}}"/> <a href="{% url advertiser_adgroup_show adgroup_key=c.key%}">{{c.name}}</a></td>
					<td>{{c.bid|currency}}</td>
					<td>
					{% if c.deleted %}
						<img src="/images/deleted.gif" width=9 height=9/>
					{% endif %}
					{% if c.active and not c.deleted %}
						<img src="/images/active.gif" width=9 height=9/>
					{% endif %}
					{% if not c.active and not c.deleted %}
						<img src="/images/paused.gif" width=9 height=9/>
					{% endif %}
					</td>
					<td>{{ c.network_type }}</td>
					<td class="numeric">{{c.stats.request_count|withsep}}</td>
					<td class="numeric">{{c.stats.impression_count|withsep}}</td>
					<td class="numeric">{{c.stats.click_count|withsep}} ({{c.stats.ctr|percentage}})
					<td class="numeric">{{c.stats.revenue|currency}}</td>
				</tr>
			{% empty %}
				<tr><td>No campaigns.</td></tr>
			{% endfor %}
		</table>
		
		<p>
			<button type="button" class="btn" onclick="form.action.value='pause'; form.submit();"><span><span>Pause</span></span></button>&nbsp;&nbsp;
			<button type="button" class="btn" onclick="form.action.value='resume'; form.submit();"><span><span>Resume</span></span></button>&nbsp;&nbsp;
			<button type="button" class="btn" onclick="form.action.value='delete'; form.submit();"><span><span>Delete</span></span></button>
		</p>		
	</form>
{% endblock %}
