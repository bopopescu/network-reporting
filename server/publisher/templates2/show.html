{% extends 'publisher/base.html' %}{% load filters %}
{% block pageTitle %}
          <div class="breadcrumb">
            <a class="linkIcon breadcrumb-back" href="{% url publisher_app_show app_key=adunit.app_key.key %}"><span class="ui-icon ui-icon-arrowthick-1-w"></span> Back to App</a>
            <h1>{{adunit.name}}</h1>
          </div>{% endblock pageTitle %}
{% block titleBarRight %}
            <span class="titlebar-right">
              <a class="button" id="dashboard-apps-editAdUnitButton" href="#">Edit ad unit settings</a>
              <a class="linkIcon" href="{% url publisher_generate adunit_key=adunit.key %}">Get code snippet <span class="ui-icon ui-icon-triangle-1-e"></span></a>
            </span>
{% endblock titleBarRight %}
{% block messageCenter %}{% endblock messageCenter %}

{% block content %}
          <section id="dashboard-adunitEditForm" class="hidden">
            <div>
              <form action="{% url publisher_adunit_update_ajax %}" method="POST" accept-charset="utf-8" id="adunitAddForm" class="adunitEditForm">
                <fieldset id="appForm-details" class="alt">
									<input type="hidden" name="adunit_key" value="{{adunit.key}}"/>
									<div id="adunitForm-fragment">
										{{adunit_form_fragment}}
									</div>	
                  <div class="form-submit"> 
                    <span class="buttonWrap"><a href="#" class="button" id="adunitEditForm-submit">Save</a></span> 
                    <span class="buttonWrap"><a href="#" class="button" id="adunitEditForm-cancel">Cancel</a></span> 
                  </div> 
                </fieldset>
              </form>
            </div>
          </section>
          <section class="offset nomargin" id="dashboard-stats">
            <div class="stats">
              <table class="stats-breakdown">
                <tbody>
                  <tr class="active" id="stats-breakdown-requests">
                    <td class="stats-breakdown-value"><span class="inner">{{adunit.stats.request_count|withsep}}</span></td>
                    <th class="stats-breakdown-name"><span class="inner">Requests</span></th>
                  </tr>
                  <tr id="stats-breakdown-impressions">
                    <td class="stats-breakdown-value"><span class="inner">{{adunit.stats.impression_count|withsep}}</span></td>
                    <th class="stats-breakdown-name"><span class="inner">Impressions</span></th>
                  </tr>
                  <tr id="stats-breakdown-clicks">
                    <td class="stats-breakdown-value"><span class="inner">{{adunit.stats.click_count|withsep}}</span></td>
                    <th class="stats-breakdown-name"><span class="inner">Clicks</span></th>
                  </tr>
                </tbody>
              </table>
              <div class="chart chart-loading stats-chart" id="dashboard-stats-chart">
                <div class="chart-loading-text">Loading ...</div>
                <div class="chart-error-text">Could not load chart</div>
                <script type="text/javascript">
                  // chart data
                  mopub.dashboardStatsChartData = {
                    //pointStart: 1294963200000,
                    pointStart: Date.UTC({{start_date.year}},{{start_date.month|add:"-1"}},{{start_date.day}}),
                    pointInterval: 86400000,
                    'requests': [
                      { '{{adunit.name}}': [{% for t in adunit.all_stats %}{{t.request_count}}{% if not forloop.last %},{% endif %} {% endfor %}] }
                    ],
                    'impressions': [
                      { '{{adunit.name}}': [{% for t in adunit.all_stats %}{{t.impression_count}}{% if not forloop.last %},{% endif %} {% endfor %}] }
                    ],
                    'clicks': [
                      { '{{adunit.name}}': [{% for t in adunit.all_stats %}{{t.click_count}}{% if not forloop.last %},{% endif %} {% endfor %}] }
                    ]
                  };
                </script>
              </div>
            </div>
            <div class="clear"></div>
          </section>

          <div class="clear"></div>

          <section id="dashboard-apps">
            <h2>Campaigns</h2>
            <div class="appData-columnHeaders">
              <table class="dataTable" id="dashboard-campaigns-columnHeaders">
                <thead>
                  <tr>
                    <th class="appData-icon"></th>
                    <th class="dataTable-name">&nbsp;</th>
                    <th class="dataTable-data">Revenue</th>
                    <th class="dataTable-data">Impressions</th>
                    <th class="dataTable-data">Clicks</th>
                    <th class="dataTable-data">CTR</th>
                  </tr>
                </thead>
              </table>
            </div>
            <div class="appData">
              <table class="dataTable appData-main">
                <tbody>
                  <tr>
                    <td class="appData-icon"><a href="#"><img src="{% if a.icon_url %}{{a.icon_url}}{% else %}/placeholders/image.gif{% endif %}" alt="Icon" width="45" height="45" /></a></td>
                    <th class="dataTable-name">Totals</th>
                    <td class="dataTable-data">{{adunit.stats.revenue|currency}}</td>
                    <td class="dataTable-data">{{adunit.stats.impression_count|withsep}}</td>
                    <td class="dataTable-data">{{adunit.stats.click_count|withsep}}</td>
                    <td class="dataTable-data">{{adunit.stats.ctr|percentage}}</td>
                  </tr>
                </tbody>
              </table>
              <div class="appData-details">
                <div class="appData-details-inner show">
                  <table class="dataTable">
                    <tbody>
                      {% for ag in adunit.adgroups %}<tr>
                        <th class="dataTable-name"><span class="inner"><a href="{% url advertiser_adgroup_show adgroup_key=ag.key %}">{{ag.name}}</a></span></th>
                        <td class="dataTable-data">{{ag.stats.revenue|currency}}</td>
                        <td class="dataTable-data">{{ag.stats.impression_count|withsep}}</td>
                        <td class="dataTable-data">{{ag.stats.click_count|withsep}}</td>
                        <td class="dataTable-data">{{ag.stats.ctr|percentage}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
                <a class="button button-small appData-details-toggleButton" href="#">Hide details</a>
              </div>
            </div>
            
          </section>

          <section id="dashboard-apps">
            <h2>Daily Counts</h2>            
            <div class="appData-columnHeaders">
              <table class="dataTable" id="dashboard-apps-columnHeaders">
                <thead>
                  <tr>
                    <th class="appData-icon"></th>
                    <th class="dataTable-name">&nbsp;</th>
                    <th class="dataTable-data">Requests</th>
                    <th class="dataTable-data">Impressions</th>
                    <th class="dataTable-data">Clicks</th>
                    <th class="dataTable-data">CTR</th>
                  </tr>
                </thead>
              </table>
            </div>
            <div class="appData" id="dashboard-app-0">
              <table class="dataTable appData-main" id="dashboard-app-0-main">
                <tbody>
                  <tr>
                    <td class="appData-icon"><a href="#"><img src="{% if a.icon_url %}{{a.icon_url}}{% else %}/placeholders/image.gif{% endif %}" alt="Icon" width="45" height="45" /></a></td>
                    <th class="dataTable-name">Totals</th>
                    <td class="dataTable-data">{{adunit.stats.request_count}}</td>
                    <td class="dataTable-data">{{adunit.stats.impression_count}}</td>
                    <td class="dataTable-data">{{adunit.stats.click_count}}</td>
                    <td class="dataTable-data">{{adunit.stats.ctr|percentage}}</td>
                  </tr>
                </tbody>
              </table>
              <div class="appData-details" id="dashboard-app-0-details">
                <div class="appData-details-inner show">
                  <table class="dataTable">
                    <tbody>
                      {% for s in adunit.all_stats %}<tr>
                        <th class="dataTable-name">{{s.date|format_date}}</th>
                        <td class="dataTable-data">{{s.request_count}}</td>
                        <td class="dataTable-data">{{s.impression_count}}</td>
                        <td class="dataTable-data">{{s.click_count}}</td>
                        <td class="dataTable-data">{{s.ctr|percentage}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
                <a class="button button-small appData-details-toggleButton" href="#">Hide details</a>
              </div>
            </div>
          </section>
{% endblock content %}
