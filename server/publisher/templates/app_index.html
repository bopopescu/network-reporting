{% extends 'publisher/base.html' %}
{% load filters %}
{% load elements %}

{% block pageTitle %}
  <h1>Dashboard</h1>
{% endblock pageTitle %}

{% block content %}

  <div id="ajaxFailure" style="display:none">
    <a href="#" id="ajaxDismiss">
      <img src="../images/icons/199_16x16.png"></img>
    </a>
    There was a problem retrieving data for some of your apps / sites.
    <a href="#" id="ajaxRetry">
      <img src="../images/icons/92_16x16.png"></img> <strong>Retry</strong>
    </a>
  </div>

  {% ifequal account.status "step4" %}
    <div class="alert-message block-message">
      Start serving ads in your app by visiting the tabs at the top of
      the page
      <br/><br/>
      <ul>
        <li><strong>Campaigns</strong> Traffic your direct sold
        advertisements and house campaigns</li>
        <li><strong>Marketplace</strong> Tap into MoPubâ€™s Real-Time
        Bidding platform to access more demand sources and get paid
        directly from MoPub</li>
        <li><strong>Networks</strong> Turn on ad campaigns from the
        major mobile ad networks you work with like AdMob, iAd,
        Millennial Media and others</li>
      </ul>
    </div>
  {% endifequal %}

  <section class="offset nomargin" id="dashboard-stats">

    <h3 class="stats-chart-title">
      Realtime Stats for {{start_date|format_date_compact}} to
      {{end_date|format_date_compact}}
    </h3>

    <div class="stats">

      {% stats_breakdown stats %}

      <div class="chart stats-chart" id="dashboard-stats-chart"></div>

    </div>
    <div class="clear"></div>
  </section>

  <div class="clear"></div>

  <section id="dashboard-apps">
    <div class="buttonBank buttonBank-right">
      <a class="button" id="dashboard-apps-addAppButton" href='{% url publisher_create_app %}'>Add an app</a>
    </div>
    <h2>Apps and sites</h2>

    {% inventory_table apps %}


    <form id='dashboardExportForm' style='display:none;' method='POST' accept-charset='utf-8' action='{% url dashboard_export %}'>
    <input name='file_type' id='appExportType' type='text' value='' />
    <input name='start' value={{start_date|date:"mdy"}} />
    <input name='end' value={{end_date|date:"mdy"}} />
</form>
<div class="buttonBank buttonBank-right">
  <select name='exportSelect' id='publisher-dashboard-exportSelect' class='selectmenu'>
    <option value='exp'>Export</option>
    <option value='xls'>XLS</option>
    <option value='csv'>CSV</option>
  </select>
</div>

  </section>

{% endblock content %}

{% block extraScripts %}
  <script type="text/html" id="app-template">
    {% include "partials/app.html" %}
  </script>
  <script type="text/html" id="adunit-template">
    {% include "partials/adunit.html" %}
  </script>
  <script type="text/javascript" src="/js/models/inventory.js?v=3"></script>
  <script type="text/javascript" src="/js/views/inventory.js?v=3"></script>
  <script>
    var mopub = mopub || {};
    $(function() {
        var graphStartDate = Date.UTC({{ start_date.year }},
              {{ start_date.month|add:"-1" }}, {# js months are zero-indexed #}
              {{ start_date.day }});
        var accountStats = {{ account_stats|safe }};

        var app_keys = {{ app_keys|safe }};

        DashboardController.initializeIndex({
            start_date: graphStartDate,
            account_stats: accountStats,
            app_keys: app_keys
        })
    });
</script>
<script src="/js/controllers/publisher.js?v=34"></script>
{% endblock %}
