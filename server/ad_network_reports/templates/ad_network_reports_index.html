{% extends "ad_network_base.html" %}
{% load filters %}

{% block adNetworkTitle %}
{% endblock %}

{% block titleBarRight %}
<span class="titlebar-link">
  <a class="linkIcon" href="/campaigns/networks/">Back to Networks  <span class="ui-icon ui-icon-triangle-1-e"></span></a>
</span>
{% endblock titleBarRight %}

{% block innerContent %}

  <ul class="pills">
    <li class="active"> <a href="#networks"> Sort by Network </a> </li>
    <li> <a href="#apps"> Sort by App </a> </li>
  </ul>

  {% comment %}
    Make the table sorted by ad network.
  {% endcomment %}
  <div class="tab-section active" id="networks">
    <table class="dataTable ad_network_table">
      <thead>
        <th class="dataTable-name" colspan="2"></th>
        <th class="dataTable-data numeric"> Revenue </th>
        <th class="dataTable-data numeric"> Attempts </th>
        <th class="dataTable-data numeric"> Impressions </th>
        <th class="dataTable-data numeric"> Fill Rate</th>
        <th class="dataTable-data numeric"> Clicks </th>
        <th class="dataTable-data numeric"> CTR </th>
      </thead>

      <tbody>
        {% for network_name, network, form in networks %}
          <tr class="shaded top-row">
            <td class="network-icon">
              <img src="/images/{{network_name|lower}}-transparent.png"
              alt="{{network_name}}" width="75" height="25" />
            </td>
			{% if network %}
            <td class="network-status dataTable-name">
                <span class="muted">Last synced: {{ network.sync_date|date }}</span>
                <div>
                    <a class="show-hide button button-small" id={{network.key}} style="width:75px;">Hide Apps</a>
                    <a class="show-status button button-small" id="{{network_name}}-status">Status</a>
                </div>
            </td>
            <td class="dataTable-data numeric">{{ network.revenue|currency }} </td>
            <td class="dataTable-data numeric">{{ network.attempts|withsep }} </td>
            <td class="dataTable-data numeric">{{ network.impressions|withsep }} </td>
            <td class="dataTable-data numeric">{{ network.fill_rate|floatformat:2 }}% </td>
            <td class="dataTable-data numeric">{{ network.clicks|withsep }} </td>
            <td class="dataTable-data numeric">{{ network.ctr|floatformat:2 }}% </td>
		    {% else %}
            <td class="network-status dataTable-name" colspan="7">
               <div>
                   <a class="show-status button button-small" id="{{network_name}}-status">Enable Reporting</a>
               </div>
            </td>
		    {% endif %}
          </tr>
          <tr class="shaded {{network_name}}-status hidden">
              <td class="dataTable-name" colspan="8">
                  <div>
                      {% if network %}
                      <dl class="formFields" style="margin:0">
                          {% if network.sync_error %}
                          <dt>Status:</dt>
                          <dd>Last synchronization failed.  Check that your credentials are correct.
                          If this error persists, please contact support@mopub.com.</dd>
                          {% endif %}
                          {% if network.app_pub_ids %}
                          <dt>Notes:</dt>
                          <dd> MoPub received a response for the following ad networks IDs.
                          Make sure these apps are properly set up in MoPub to view the reports.
                          <br/><br/>
                          {{ network.app_pub_ids }}
                          </dd>
                          {% endif %}
                      </dl>
                      {% endif %}
                      <form class="loginCredentials" id="form-{{form.ad_network}}">
                          <div class="form-{{form.ad_network}}-message hidden alert-message block-message warning">
                          </div>
                          <fieldset>
                              <h2>{{network_name}} Credentials</h2>
                              <dl class="formFields" style="margin:0">
                                  {% ifequal form.ad_network "inmobi" %}
                                    <dt> Access ID: </dt>
                                    <dd>
                                      <input type="text" name="{{form.ad_network}}-username" id="id_username" class=" input-text" value=""> {{form.username.errors}}
                                      <a href="#" class="whatsthis" id="inmobi-access-helpLink"> What's This? </a>
                                    </dd>

                                    <dt> Secret Key: </dt>
                                    <dd>
                                      <input type="password" name="{{form.ad_network}}-password"  id="id_password" class=" input-text" value="">  {{form.password.errors}}
                                      <a href="#" class="whatsthis" id="inmobi-secret-helpLink"> What's This? </a>
                                    </dd>

                                  {% else %}
                                      {% ifequal form.ad_network "mobfox" %}
                                      {% else %}
                                        <dt> Username: </dt>
                                        <dd> <input type="text" name="{{form.ad_network}}-username" id="id_username" class=" input-text" value=""> {{form.username.errors}}</dd>

                                        <dt> Password: </dt>
                                        <dd> <input type="password" name="{{form.ad_network}}-password"  id="id_password" class=" input-text" value="">  {{form.password.errors}}</dd>
                                      {% endifequal %}
                                  {% endifequal %}


                                  {% if form.ad_network == "admob" %}
                                    <dt> Client ID: </dt>
                                    <dd> {{form.client_key}} </dd>
                                  {% endif %}

                                  <dt><input name="email" type="checkbox" /> </dt>
                                  <dd> Send me daily emails with my network stats </dd>
                                  <dt></dt>
                                  <dd>
                                  <input class="button" type="submit" value="Update" />
                                  <input class="show-status button" id="{{network_name}}-status" value="Cancel" style="width:50px" />
                                  </dd>
                              </dl>
                          </fieldset>
                      </form>
                  </div>
              </td>
          </tr>
		  {% if network %}
          {% for app in network.sub_data_list %}
          <tr class="sub-rows {% if not forloop.last %} add-border {% endif %} for-key-{{network.key}}">
              <td class="dataTable-name" colspan="2">
                <a href="{% url ad_network_app_detail app.key %}">{{app.name}}</a>
              </td>
              <td class="dataTable-data numeric">{{ app.revenue|currency }}</td>
              <td class="dataTable-data numeric">{{ app.attempts|withsep }}</td>
              <td class="dataTable-data numeric">{{ app.impressions|withsep }}</td>
              <td class="dataTable-data numeric">{{ app.fill_rate|floatformat:2 }}%</td>
              <td class="dataTable-data numeric">{{ app.clicks|withsep }}</td>
              <td class="dataTable-data numeric">{{ app.ctr|floatformat:2 }}%</td>
            </tr>
          {% endfor %}
		  {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </div>


  {% comment %}
    Make the table sorted by app name. This table is hidden to start.
  {% endcomment %}
  <div class="tab-section" id="apps">
    <table class="simpletable campaignData-main ad_network_table">
      <thead>
        <th class="dataTable-name"></th>
        <th class="dataTable-data numeric"> Revenue </th>
        <th class="dataTable-data numeric"> Attempts </th>
        <th class="dataTable-data numeric"> Impressions </th>
        <th class="dataTable-data numeric"> Fill Rate </th>
        <th class="dataTable-data numeric"> Clicks </th>
        <th class="dataTable-data numeric"> CTR </th>
      </thead>

      <tbody>
        {% for app_name, app in apps %}
        <div class="section">
          <tr class="shaded top-row" id="{{app.key}}">
            <td class="dataTable-name"> {{app_name}} </td>
            <td class="dataTable-data numeric">{{ app.revenue|currency }}</td>
            <td class="dataTable-data numeric">{{ app.attempts|withsep }}</td>
            <td class="dataTable-data numeric">{{ app.impressions|withsep }}</td>
            <td class="dataTable-data numeric">{{ app.fill_rate|floatformat:2 }}%</td>
            <td class="dataTable-data numeric">{{ app.clicks|withsep }}</td>
            <td class="dataTable-data numeric">{{ app.ctr|floatformat:2 }}%</td>
          </tr>
          {% for network in app.sub_data_list %}
          <tr class="sub-rows {% if not forloop.last %} add-border {% endif %}">
              <td class="dataTable-name">
                 <a href="{% url ad_network_app_detail network.key %}">{{network.name}} </a>
              </td>
              <td class="dataTable-data numeric">{{ network.revenue|currency }}</td>
              <td class="dataTable-data numeric">{{ network.attempts|withsep }}</td>
              <td class="dataTable-data numeric">{{ network.impressions|withsep }}</td>
              <td class="dataTable-data numeric">{{ network.fill_rate|floatformat:2 }}%</td>
              <td class="dataTable-data numeric">{{ network.clicks|withsep }}</td>
              <td class="dataTable-data numeric">{{ network.ctr|floatformat:2 }}%</td>
            </tr>
          {% endfor %}
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>


  {# What's This? content #}

  <div class="hidden" id="inmobi-access-helpContent">
    To access publisher reports from InMobi, you will need to request an Access ID
    and a Secret Key from their help desk. To do this, send a request to
    <a href="mailto:helpdesk@inmobi.com"> helpdesk@inmobi.com </a> with "Enable Publisher
    Reports" as the subject line along with your username/email. InMobi will then assign
    you a new Access ID and Secret Key, which you can enter here.
  </div>

  <div class="hidden" id="inmobi-secret-helpContent">
        To access publisher reports from InMobi, you will need to request an Access ID
    and a Secret Key from their help desk. To do this, send a request to
    <a href="mailto:helpdesk@inmobi.com"> helpdesk@inmobi.com </a> with "Enable Publisher
    Reports" as the subject line along with your username/email. InMobi will then assign
    you a new Access ID and Secret Key, which you can enter here.
  </div>

{% endblock innerContent %}

{% block extraScripts %}
  {{ block.super }}
  <script type="text/javascript" src="/js/mopub-advertiser.js?v=46"></script>
  <script>
    $(function () {
        mopub.Advertiser.initializeAdReportsIndex();
        account_key = '{{ account_key }}';
        mopub.Advertiser.initializeCredentialsPage(account_key);
    });
  </script>
{% endblock extraScripts %}
