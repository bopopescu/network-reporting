{% extends "base.html" %}
{% load filters %}

{% block pageTitle %}
  <h1>Marketplace</h1>
{% endblock pageTitle %}

{% block navLinks %}
  <li><a href="{% url publisher_index %}">Dashboard</a></li>
  <li><a href="{% url advertiser_campaign %}">Campaigns</a></li>
  <li class="active"><a href="{% url marketplace_index %}">Marketplace</a></li>
  <li><a href="{% url reports_index %}">Reports</a></li>
{% endblock navLinks %}

{% block messageCenter %} {% endblock messageCenter %}
{% block dateButtons %} {% endblock dateButtons %}

{% block content %}

  <div class="alert-message block-message clearfix">
    <a href="#" class="close"> x </a>
    We've just launched MoPub Marketplace, our state of the art real-time bidding exchange.
    Flip the On/Off switch to get started,
    or take a look at our <a href="{% url mpx_info %}">information page</a> if you want to know more about how it works.
    <br />
    <!-- <div class="lightswitch"> -->
    <!--   <div class="switch on"></div> -->
    <!-- </div> -->
    <a class="btn start icon right" href="{% url mpx_info %}">Get Started</a>
  </div>


  <ul class="tabs">
    <li class="active"> <a href="#performance"> App Performance </a> </li>
    <li> <a href="#controls"> Creative Performance </a> </li>
    <li> <a href="#settings"> Settings </a> </li>
  </ul>


  <div class="active tab-section" id="performance">

    {% if marketplace %}

      <div id="marketplace_rollups"></div>

      <div class="rollup fig3">
        <div class="data-figure">
          <div class="figure">
            20.6M
          </div>
          <div class="label">
            Impressions
          </div>
        </div>
        <div class="data-figure">
          <div class="figure">
            1.1M
          </div>
          <div class="label">
            Clicks
          </div>
        </div>
          <div class="data-figure">

          <div class="figure">
            $893K
          </div>
          <div class="label">
            Revenue
          </div>
        </div>
      </div>



      <div id="marketplace_info">

        <table class="zebra-striped simpletable" id="marketplace_targeting">

          <thead>
            <th>App</th>
            <th>Revenue</th>
            <th>eCPM</th>
            <th>Attempts</th>
            <th>Impressions</th>
            <th>Fill Rate</th>
            <th>Clicks</th>
            <th>CTR</th>
            <th>Price Floor</th>
          </thead>

          <tbody>
{% comment %}
          {% for app in marketplace.account.app_set %}
              <tr>

                {# App Icon, Name, and Type #}
                <td class="clearfix">
                  <img src="{{app.icon|binary_data|default_if_none:"/placeholders/image.gif"}}" alt="Icon" width="45" height="45" class="app-icon"/>

                  <div class="app-detail">
                    <a href="{% url publisher_app_show app_key=app.key %}">{{app.name}}</a>

                    <span class="muted unbold">({{app.app_type_text}})</span>

                    <br />

                    <a href="#{{app.key}}" class="adunits">Show Adunits</a>
                    <ul class="hidden adunits adunit-data-{{app.key}}">
                      {% for adunit in app.all_adunits %}
                        <li class="adunit" id="adunit-{{adunit.key}}">
                          {{adunit.name}}
                        </li>
                      {% endfor %}
                    </ul>
                  </div>

                </td>

                {# App Revenue from Marketplace #}
                <td>
                  0
                  <br />
                  --
                  <ul class="hidden adunits" id="{{app.key}}">
                    {% for adunit in app.all_adunits %}
                      <li class="adunit" id="adunit-{{adunit.key}}">
                        0
                      </li>
                    {% endfor %}
                  </ul>
                </td>

                {# App eCPM, (marketplace revenue/impressions)*1000 #}
                <td>
                  0
                  <br />
                  --

                  <ul class="hidden adunits" id="{{app.key}}">
                    {% for adunit in app.all_adunits %}
                      <li class="adunit" id="{{adunit.key}}">
                        0
                      </li>
                    {% endfor %}
                  </ul>
                </td>

                {# Attempts #}
                <td>
                  0
                  <br />
                  --

                  <ul class="hidden adunits" id="{{app.key}}">
                    {% for adunit in app.all_adunits %}
                      <li class="adunit" id="{{adunit.key}}">
                        0
                      </li>
                    {% endfor %}
                  </ul>
                </td>

                {# Impressions (filled by the marketplace) #}
                <td>
                  0
                  <br />
                  --

                  <ul class="hidden adunits" id="{{app.key}}">
                    {% for adunit in app.all_adunits %}
                      <li class="adunit" id="adunit-{{adunit.key}}">
                        0
                      </li>
                    {% endfor %}
                  </ul>
                </td>

                {# Fill Rate (impressions/attempts) #}
                <td>
                  0
                  <br />
                  --

                  <ul class="hidden adunits" id="{{app.key}}">
                    {% for adunit in app.all_adunits %}
                      <li class="adunit" id="adunit-{{adunit.key}}">
                        0
                      </li>
                    {% endfor %}
                  </ul>
                </td>

                {# Clicks #}
                <td>
                  0
                  <br />
                  --

                  <ul class="hidden adunits adunit-data-{{app.key}}">
                    {% for adunit in app.all_adunits %}
                      <li class="adunit" id="adunit-{{adunit.key}}">
                        0
                      </li>
                    {% endfor %}
                  </ul>
                </td>

                {# CTR (click through rate, clicks/impressions) #}
                <td>
                  <span class="ctr_total">0</span>
                  <ul class="hidden adunits adunit-data-{{app.key}}">
                    <br />
                    {% for adunit in app.all_adunits %}
                      <li class="adunit" id="adunit-{{adunit.key}}">
                        0
                      </li>
                    {% endfor %}
                  </ul>
                </td>

                {# Price Floor #}
                <td>
                  0
                  <br />
                  --

                  <ul class="hidden adunits adunit-data-{{app.key}}">
                    {% for adunit in app.all_adunits %}
                      <li class="adunit" id="adunit-{{adunit.key}}">
                        0
                      </li>
                    {% endfor %}
                  </ul>
                </td>
              </tr>
            {% endfor %}

{% endcomment %}
          </tbody>
        </table>
      </div>

    {% else %}

      <div class="alert-message block-message info">
        Marketplace is a new type of campaign we're offering. You'd be a fool not to use it dude!
      </div>

    {% endif %}

  </div>

  <div class="tab-section" id="controls">
    <div class="clearfix alert-message block-message info">
      <div class="close">x</div>
      Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enimad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
    </div>

  </div>

  <div class="clearfix tab-section" id="settings">
    <div class="well">
      Blindness?
    </div>

    <div class="well">
      Awesome blocklist goes here.
    </div>

    <div class="right button-group">
      <div class="big disabled btn"> Discard Changes </div>
      <div class="big primary btn"> Save </div>
    </div>
  </div>

{% endblock content %}


{% block extraScripts %}
  <script type="text/html" id="app-template">
    {% include "partials/app.html" %}
  </script>
  <script type="text/html" id="adunit-template">
    {% include "partials/adunit.html" %}
  </script>
  <script type="text/html">
    {% include "partials/inventory.html" %}
  </script>
  <script type="text/javascript" src="/js/underscore.min.js"></script>
  <script type="text/javascript" src="/js/json2.js"></script>
  <script type="text/javascript" src="/js/backbone.min.js"></script>
  <script type="text/javascript" src="/js/mopub-marketplace.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
        var app_keys = {{ app_keys|safe }};
        Marketplace.fetchAllApps(app_keys);
    });
  </script>
{% endblock extraScripts %}
