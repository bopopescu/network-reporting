var mopub=mopub||{};(function(h,k,l){var b=k.Model.extend({defaults:{name:"",budget:0,budget_type:"",start_datetime:new Date(),end_datetime:null,active:false}});function d(o,p){if(o===null||p===null){return null}return(o===0)?0:p/o}function j(o,p){if(o===null||p===null){return null}return(o===0)?0:p/o}function n(o,p){if(p===null){return"--"}switch(o){case"click_count":case"conversion_count":case"goal":case"impression_count":case"request_count":return mopub.Utils.formatNumberWithCommas(p);case"cpm":case"revenue":return"$"+mopub.Utils.formatNumberWithCommas(p.toFixed(2));case"conv_rate":case"ctr":case"fill_rate":return mopub.Utils.formatNumberAsPercentage(p);case"status":return p;default:throw'Unsupported stat "'+o+'".'}}var f={calculate_ctr:d,calculate_fill_rate:j,format_stat:n};var i=k.Model.extend({get_stat:function(o){if(!this.has(o)){return null}return this.get(o)},get_formatted_stat:function(o){return n(o,this.get_stat(o))},get_stat_for_day:function(r,o){if(!this.has("daily_stats")){return null}var p=this.get("daily_stats");if(o>=p.length){return null}var q=p[o];if(!r in q){return null}return q[r]},url:function(){return"/api/adgroup/"+this.id}});var a=k.Collection.extend({model:i,get_stat_sum:function(o){return this.reduce(function(p,q){if(p===null||!q.has(o)){return null}return p+q.get(o)},0)},get_stat:function(o){switch(o){case"ctr":return d(this.get_stat("impression_count"),this.get_stat("click_count"));case"fill_rate":return j(this.get_stat("request_count"),this.get_stat("impression_count"));case"click_count":case"conversion_count":case"impression_count":case"request_count":case"revenue":return this.get_stat_sum(o);default:throw'Unsupported stat "'+o+'".'}},get_formatted_stat:function(o){return n(o,this.get_stat(o))},get_stat_sum_for_day:function(p,o){return this.reduce(function(q,r){if(q===null||!r.has("daily_stats")||o>=r.get("daily_stats").length||!(p in r.get("daily_stats")[o])){return null}return q+r.get("daily_stats")[o][p]},0)},get_stat_for_day:function(p,o){switch(p){case"ctr":return d(this.get_stat_for_day("impression_count",o),this.get_stat_for_day("click_count",o));case"fill_rate":return j(this.get_stat_for_day("request_count",o),this.get_stat_for_day("impression_count",o));case"click_count":case"conversion_count":case"impression_count":case"request_count":case"revenue":return this.get_stat_sum_for_day(p,o);default:throw'Unsupported stat "'+p+'".'}},get_formatted_stat_for_day:function(p,o){return n(p,this.get_stat_for_day(p,o))},get_total_daily_stats:function(p){var q=[];var o;for(o in this.at(0).get("daily_stats")){q.push(this.get_stat_for_day(p,o))}return q},get_chart_data:function(q){var p=this.filter(function(u){return u.has(q)&&u.has("daily_stats")});if(p.length===0){return[]}var o=l.sortBy(p,function(u){return -u.get("impression_count")});var s=o.splice(0,3);var r=new a(o);var t=s.map(function(u){var v={};v[u.get("name")]=l.map(u.get("daily_stats"),function(w){return w[q]});return v});if(r.size()){t.push({Others:r.get_total_daily_stats(q)})}if(q==="ctr"){t.push({"MoPub Optimized":this.get_total_daily_stats("ctr")})}return t},get_days:function(){return this.reduce(function(o,p){return(p.has("daily_stats")&&p.get("daily_stats").length>o)?p.get("daily_stats").length:o},0)},isFullyLoaded:function(){return this.reduce(function(o,p){return o&&p.has("impression_count")},true)}});var e=k.Model.extend({defaults:{active:false,attempts:0,clicks:0,ctr:0,ecpm:0,fill_rate:0,impressions:0,name:"",price_floor:0,requests:0,revenue:0,stats_endpoint:"all"},validate:function(o){if(typeof(o.price_floor)!=="undefined"){var p=Number(o.price_floor);if(isNaN(p)){return"Please enter a valid number for the price floor"}}},url:function(){var o=this.get("stats_endpoint");return"/api/app/"+this.app_id+"/adunits/"+this.id+"?"+window.location.search.substring(1)+"&endpoint="+o}});var c=k.Collection.extend({model:e,url:function(){var o=this.stats_endpoint;return"/api/app/"+this.app_id+"/adunits/?"+window.location.search.substring(1)+"&endpoint="+o}});var g=k.Model.extend({defaults:{name:"",url:"#",icon_url:"/placeholders/image.gif",app_type:"",active:false,attempts:0,clicks:0,ctr:0,ecpm:0,fill_rate:0,impressions:0,price_floor:0,requests:0,revenue:0,stats_endpoint:"all"},url:function(){var o=this.get("stats_endpoint");return"/api/app/"+this.id+"?"+window.location.search.substring(1)+"&endpoint="+o},parse:function(o){var p=o[0];if(p.app_type==="iphone"){p.app_type="iOS"}if(p.app_type==="android"){p.app_type="Android"}if(p.app_type==="mweb"){p.app_type="Mobile Web"}return p},get_summed:function(o){if(typeof(this.get(o))!=="undefined"){var p=this.get(o);var q=l.reduce(p,function(r,s){return r+s},0);return q}return null}});var m=k.Collection.extend({model:g,url:function(){var o=this.stats_endpoint;return"/api/app/?"+window.location.search.substring(1)+"&endpoint="+o},fetchAdUnits:function(){this.each(function(o){o.adunits=new c();o.adunits.app_id=o.id;o.adunits.fetch()})}});window.AdUnit=e;window.AdUnitCollection=c;window.App=g;window.AppCollection=m;window.AdGroup=i;window.AdGroups=a;window.ModelHelpers=f}(this.jQuery,this.Backbone,this._));