var mopub=mopub||{};(function(h,b,r){function a(){var s=h("#dashboard-stats .stats-breakdown .active");if(s.attr("id")=="stats-breakdown-ctr"){return"line"}else{return"area"}}function e(t,s){var u=t.all_stats["||"]["daily_stats"];mopub.dashboardStatsChartData={pointStart:s,pointInterval:86400000,requests:[{Total:mopub.Stats.statArrayFromDailyStats(u,"request_count")}],impressions:[{Total:mopub.Stats.statArrayFromDailyStats(u,"impression_count")}],clicks:[{Total:mopub.Stats.statArrayFromDailyStats(u,"click_count")}],users:[{Total:mopub.Stats.statArrayFromDailyStats(u,"user_count")}]};mopub.Chart.setupDashboardStatsChart(a())}function i(s){r.each(s,function(t){var u=new App({id:t,stats_endpoint:"all"});u.bind("change",function(v){var w=new AppView({model:v,el:"#dashboard-apps"});w.renderInline()});u.fetch()})}function k(t){var s=new AdUnitCollection();s.app_id=t;s.stats_endpoint="all";s.bind("reset",function(u){r.each(u.models,function(v){var w=new AdUnitView({model:v,el:"#dashboard-apps"});w.renderInline()})});s.fetch({success:function(u){h("table").trigger("update");h("#"+t+"-img").hide()}})}function l(){q();h("#appForm-submit").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(s){s.preventDefault();h("#appForm").submit()});h('#appForm input[name="app_type"]').click(function(s){h("#appForm .appForm-platformDependent").removeClass("iphone").removeClass("android").addClass(h(this).val())}).filter(":checked").click();h('input[name="name"]').change(function(){var s=h.trim(h(this).val());h("#appForm-adUnitName").val(s+" banner ad")});h("#appForm-search-button").button({icons:{primary:"ui-icon-search"}}).click(function(v){v.preventDefault();if(h(this).button("option","disabled")){return}h("#searchAppStore-loading").show();h("#dashboard-searchAppStore-custom-modal").dialog({buttons:[{text:"Cancel",click:function(){h("#searchAppStore-results").html("");h(this).dialog("close")}}]});var t=h('#appForm input[name="name"]').val();var s=document.createElement("script");s.src="http://ax.itunes.apple.com/WebObjects/MZStoreServices.woa/wa/wsSearch"+ +"?entity=software&limit=10&callback=loadedArtwork&term="+t;var u=document.getElementsByTagName("head")[0];(u||document.body).appendChild(s)});if(h("#appForm-name").val()===""){h("#appForm-search-button").button("disable");h("#appForm-search").button("disable");h("#appForm-market-search-button").button("disable");h("#appForm-market-search").button("disable")}h("#appForm-name").keyup(function(u){var s=h.trim(h(this).val());var t=h('input:radio[name="app_type"]:checked').val();if(s.length){h("#appForm-search-button").button("enable");h("#appForm-market-search-button").button("enable")}else{h("#appForm-search-button").button("disable");h("#appForm-market-search-button").button("disable")}if(u.keyCode==13){if(t=="iphone"){h("#appForm-search-button").click()}else{if(t=="android"){h("#appForm-market-search-button").click()}}}});h("#appForm-changeIcon-link").click(function(s){s.preventDefault();h(this).hide();h("#appForm-icon-upload").show();h('#appForm input[name="img_url"]').val("")});h('input[name="app_type"]').click(function(s){h("#appForm .appForm-platformDependent").removeClass("iphone").removeClass("android").removeClass("mweb").addClass(h(this).val())}).filter(":checked").click()}function c(){l();h("#appForm.appEditForm").ajaxForm({data:{ajax:true},dataType:"json",success:function(t,u,v,s){h("#appEditForm-loading").hide();if(t.success){window.location.reload()}else{h(".form-error-text","#appForm").remove();h.each(t.errors,function(w,z){var x=z[0];var y=h("<div>").append(z[1]).addClass("form-error-text");h("input[name="+x+"]","#appForm").addClass("error").parent().append(y);h("select[name="+x+"]","#appForm").addClass("error").parent().append(y)});l();window.location.hash="";window.location.hash="appForm"}}});h("#appEditForm-submit").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(s){s.preventDefault();h("#appEditForm-loading").show();h("#appForm").submit()});h("#appEditForm-cancel").click(function(s){s.preventDefault();h("#dashboard-appEditForm").slideUp("fast")});h("#dashboard-apps-editAppButton").button({icons:{primary:"ui-icon-wrench"}}).click(function(s){s.preventDefault();if(h("#dashboard-appEditForm").is(":visible")){h("#dashboard-appEditForm").slideUp("fast")}else{h("#dashboard-appEditForm").slideDown("fast")}})}function p(){h("#adunit-device_format_phone").parent().buttonset();h("#adunit-device_format_phone").click(function(s){h("#adForm-tablet-container").hide();h("#adForm-phone-container").show().find('input[type="radio"]')[0].click()});h("#adunit-device_format_tablet").click(function(s){console.log("tablet clicked");h("#adForm-phone-container").hide();h("#adForm-tablet-container").show().find('input[type="radio"]')[0].click()});h("#dashboard-apps-addAdUnitButton").button({icons:{primary:"ui-icon-circle-plus"}}).click(function(s){s.preventDefault();if(h("#dashboard-adunitAddForm").is(":visible")){h("#dashboard-adunitAddForm").slideUp("fast")}else{h("#dashboard-adunitAddForm").slideDown("fast")}});h("#adunitAddForm-submit").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(s){s.preventDefault();h("#adunitForm-loading").show();h("#adunitAddForm").submit()});h("#adunitAddForm-cancel").click(function(s){s.preventDefault();h("#dashboard-adunitAddForm").slideUp("fast",function(){h("#dashboard-apps-addAdUnitButton").show()})});h("#adunitAddForm").ajaxForm({data:{ajax:true},dataType:"json",success:function(t,u,v,s){h("#adunitForm-loading").hide();if(t.success){window.location.reload()}else{l();p();window.location.hash="";window.location.hash="adunitForm"}}});h("#adForm-phone-formats").each(function(){var s=h(this);h('input[type="radio"]',s).click(function(y){var u=h(this);var x=u.parents(".adForm-format");h(".adForm-format-image").css({opacity:0.5});h(".adForm-format-image",x).css({opacity:1});var w=h(".full_only");var v=h(".banner_only");if(h(this).attr("id")=="appForm-adUnitFormat-full-tablet"||h(this).attr("id")=="appForm-adUnitFormat-full"){w.show();v.hide()}else{w.hide();v.show()}var t=h(".custom_only");if(h(this).attr("id")=="appForm-adUnitFormat-tablet-custom"||h(this).attr("id")=="appForm-adUnitFormat-custom"){t.show()}else{t.hide()}}).filter(":checked").click();h(".adForm-format-image",s).click(function(v){var u=h(this);var t=u.parents(".adForm-format");h('input[type="radio"]',t).click()});h('.adForm-format-details input[type="text"]',s).focus(function(){var t=h(this);var u=t.parents(".adForm-format");h('input[type="radio"]',u).click()})});h("#adForm-tablet-formats").each(function(){var s=h(this);h(this).find('input[type="radio"]').click(function(z){var v=h(this).parent().index();var t=h("#adForm-images-container");t.children().hide();var y=t.children()[v];h(y).show().css({opacity:1});var x=h(".full_only");var w=h(".banner_only");if(h(this).attr("id")=="appForm-adUnitFormat-full-tablet"||h(this).attr("id")=="appForm-adUnitFormat-full"){x.show();w.hide()}else{x.hide();w.show()}var u=h(".custom_only");if(h(this).attr("id")=="appForm-adUnitFormat-tablet-custom"||h(this).attr("id")=="appForm-adUnitFormat-custom"){u.show()}else{u.hide()}}).first().click()});h("#adunit-device_format_phone").parent().children().filter(":checked").click().each(function(){var t=h(this).val();var s="#adForm-"+t+"-container";h(s).find(".possible-format").click()})}function d(){p();h("#dashboard-apps-editAdUnitButton").button({icons:{primary:"ui-icon-wrench"}}).click(function(s){s.preventDefault();if(h("#dashboard-adunitEditForm").is(":visible")){h("#dashboard-adunitEditForm").slideUp("fast")}else{h("#dashboard-adunitEditForm").slideDown("fast")}});h("#adunitEditForm-submit").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(s){s.preventDefault();h("#adunitForm-loading").show();h("#adunitAddForm").submit()});h("#adunitEditForm-cancel").click(function(s){s.preventDefault();h("#dashboard-adunitEditForm").slideUp("fast")});h("#adunitAddForm").ajaxForm({data:{ajax:true},dataType:"json",success:function(t,u,v,s){h("#adunitForm-loading").hide();if(t.success){window.location.reload()}else{l();p();window.location.hash="";window.location.hash="adunitForm"}}})}function n(){h(".appData-details").each(function(){var u=h(this);var v=h(".appData-details-inner",u);var t=h(".appData-details-toggleButton",u);function x(){var y=h(".ui-button-text",t);y=t;if(y.length===0){}return y}function s(){v.removeClass("hide");v.addClass("show");t.button("option",{icons:{primary:"ui-icon-triangle-1-n"}});x().text("Hide details")}function w(){v.removeClass("show");v.addClass("hide");t.button("option",{icons:{primary:"ui-icon-triangle-1-s"}});x().text("Show details")}if(v.hasClass("show")){s()}else{v.hide();w()}t.click(function(y){y.preventDefault();if(v.hasClass("show")){v.slideUp("fast");w()}else{v.slideDown("fast");s()}})})}function j(){h("#dashboard-dateOptions input").click(function(){var t=h(this).val();if(t=="custom"){h("#dashboard-dateOptions-custom-modal").dialog({width:570,buttons:[{text:"Set dates",css:{fontWeight:"600"},click:function(){var z=h("#dashboard-dateOptions-custom-from").datepicker("getDate");var v=h("#dashboard-dateOptions-custom-to").datepicker("getDate");var x=Math.ceil((v.getTime()-z.getTime())/(86400000))+1;var y=z.getDate();var u=z.getMonth()+1;var A=z.getFullYear();h(this).dialog("close");var w=document.location.href.replace(/\?.*/,"");document.location.href=w+"?r="+x+"&s="+A+"-"+u+"-"+y}},{text:"Cancel",click:function(){h(this).dialog("close")}}]})}else{var s=document.location.href.replace(/\?.*/,"");document.location.href=s+"?r="+t}});h("#stats-breakdown-dateOptions input").click(function(){h(".stats-breakdown-value").hide();h(".stats-breakdown-value."+h(this).val()).show()});h("#dashboard-dateOptions-custom-from").datepicker({defaultDate:"-15d",maxDate:"0d",onSelect:function(v){var t=h("#dashboard-dateOptions-custom-to");var s=h(this).data("datepicker");var u=h.datepicker.parseDate(s.settings.dateFormat||h.datepicker._defaults.dateFormat,v,s.settings);t.datepicker("option","minDate",u)}});h("#dashboard-dateOptions-custom-to").datepicker({defaultDate:"-1d",maxDate:"0d",onSelect:function(v){var t=h("#dashboard-dateOptions-custom-from");var s=h(this).data("datepicker");var u=h.datepicker.parseDate(s.settings.dateFormat||h.datepicker._defaults.dateFormat,v,s.settings);t.datepicker("option","maxDate",u)}})}function g(){h("#dashboard-delete-link").click(function(s){s.preventDefault();h("#dashboard-delete-modal").dialog({buttons:[{text:"Delete",click:function(){h(this).dialog("close");h("#dashboard-deleteForm").submit()}},{text:"Cancel",click:function(){h(this).dialog("close")}}]})})}function q(){h("#appForm-search-button").button({icons:{primary:"ui-icon-search"}}).click(function(v){v.preventDefault();if(h(this).button("option","disabled")){return}h("#searchAppStore-loading").show();h("#dashboard-searchAppStore-custom-modal").dialog({buttons:[{text:"Cancel",click:function(){h("#searchAppStore-results").html("");h(this).dialog("close")}}]});var t=h('#appForm input[name="name"]').val();var s=document.createElement("script");s.src="http://ax.itunes.apple.com/WebObjects/MZStoreServices.woa/wa/wsSearch?entity=software&limit=10&callback=loadedArtwork&term="+t;var u=document.getElementsByTagName("head")[0];(u||document.body).appendChild(s)})}function m(){j();h(".stats-breakdown tr").click(function(s){h("#dashboard-stats-chart").fadeOut(100,function(){mopub.Chart.setupDashboardStatsChart(a());h(this).show()})})}function o(s){}var f={initializeIndex:function(s){m();e(s.account_stats,s.start_date);i(s.app_keys);r.each(s.app_keys,function(t){k(t)});h("#dashboard-apps-addAppButton").button({icons:{primary:"ui-icon-circle-plus"}});h(".appData-id").each(function(){var u=h(this);var t=u.parents("tr");t.hover(function(){u.show()},function(){u.hide()})})},initializeGeo:function(s){m();mopub.Chart.setupDashboardStatsChart(a())},initializeAppDetail:function(s){m();c();p();g();q();n();mopub.Chart.setupDashboardStatsChart(a());h("#publisher-app-exportSelect").change(function(t){t.preventDefault();var u=h(this).val();if(u!="exp"){h("#appExportForm").find("#appExportType").val(u).end().submit()}h(this).selectmenu("index",0)});h("#publisher-app-exportSelect-menu").find("li").first().hide()},initializeAdunitDetail:function(s){m();g();n();d();mopub.Chart.setupDashboardStatsChart(a());h("#advertisers-testAdServer").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(t){t.preventDefault();h("#adserverTest").dialog({buttons:{Close:function(){h(this).dialog("close")}}});h("#adserverTest-iFrame").attr("src",h("#adserverTest-iFrame-src").text())})},initializeAppCreate:function(s){m();l();p()}};window.DashboardController=f})(this.jQuery,this.Backbone,this._);var artwork_json;function loadedArtwork(c){if(!$("#dashboard-searchAppStore-custom-modal").dialog("isOpen")){return}$("#searchAppStore-results").html("");$("#searchAppStore-loading").hide();$("#dashboard-searchAppStore-custom-modal").dialog("close");artwork_json=c;var a=c.resultCount;if(a==0){$("#searchAppStore-results").append("<div class='adForm-appSearch-text' />").append("No results found");$("#dashboard-searchAppStore-custom-modal").dialog("open");return}for(var b=0;b<a;b++){if(b>10){break}var d=c.results[b];$("#searchAppStore-results").append($("<div class='adForm-appSearch' />").append($("<div class='adForm-appSearch-img' />").append($("<img />").attr("src",d.artworkUrl60).width(40).height(40)).append($("<span />"))).append($("<div class='adForm-appSearch-text' />").append($("<span />").append($('<a href="#" onclick="selectArtwork('+b+');return false";>'+d.trackName+"</a>")).append("<br />"+d.artistName))).append($("<div class='clear' />")))}$("#dashboard-searchAppStore-custom-modal").dialog("open")}function selectArtwork(a){$("#searchAppStore-results").html("");$("#appForm-icon").html("");$("#dashboard-searchAppStore-custom-modal").dialog("close");var d=artwork_json.results[a];var b=$('input:radio[name="app_type"]:checked').val();var c=$("app_form");$('#appForm input[name="name"]').val(d.trackName);$('#appForm input[name="description"]').val(d.description);if(b=="iphone"){$('#appForm input[name="url"]').val(d.trackViewUrl)}else{if(b=="android"){$('#appForm input[name="package"]').val(d.trackViewUrl)}}$('#appForm input[name="img_url"]').val(d.artworkUrl60);$('#appForm select[name="primary_category"]').val(d.primaryGenreName.toLowerCase());$('#appForm select[name="secondary_category"]').val(d.genres[1].toLowerCase());$("#appForm-icon").append($("<img />").attr("src",d.artworkUrl60).width(40).height(40).append($("<span />")))};