var mopub=mopub||{};(function(a){a(document).ready(function(){var i={data:{ajax:true},dataType:"json",success:function(I,J,K,H){a("#appEditForm-loading").hide();if(I.success){window.location.reload()}else{a(".form-error-text","#appForm").remove();a.each(I.errors,function(L,O){var M=O[0];var N=a("<div>").append(O[1]).addClass("form-error-text");a("input[name="+M+"]","#appForm").addClass("error").parent().append(N);a("select[name="+M+"]","#appForm").addClass("error").parent().append(N)});f();window.location.hash="";window.location.hash="appForm"}}};a("#appForm.appEditForm").ajaxForm(i);i={data:{ajax:true},dataType:"json",success:function(I,J,K,H){a("#adunitForm-loading").hide();if(I.success){window.location.reload()}else{f();m();window.location.hash="";window.location.hash="adunitForm"}}};a("#adunitAddForm").ajaxForm(i);function e(){var H=a("#dashboard-stats .stats-breakdown .active");if(H.attr("id")=="stats-breakdown-ctr"){return"line"}else{return"area"}}a(".stats-breakdown tr").click(function(H){a("#dashboard-stats-chart").fadeOut(100,function(){mopub.Chart.setupDashboardStatsChart(e());a(this).show()})});a("#dashboard-dateOptions input").click(function(){var I=a(this).val();if(I=="custom"){a("#dashboard-dateOptions-custom-modal").dialog({width:570,buttons:[{text:"Set dates",css:{fontWeight:"600"},click:function(){var O=a("#dashboard-dateOptions-custom-from").datepicker("getDate");var K=a("#dashboard-dateOptions-custom-to").datepicker("getDate");var M=Math.ceil((K.getTime()-O.getTime())/(86400000))+1;var N=O.getDate();var J=O.getMonth()+1;var P=O.getFullYear();a(this).dialog("close");var L=document.location.href.replace(/\?.*/,"");document.location.href=L+"?r="+M+"&s="+P+"-"+J+"-"+N}},{text:"Cancel",click:function(){a(this).dialog("close")}}]})}else{var H=document.location.href.replace(/\?.*/,"");document.location.href=H+"?r="+I}});a("#stats-breakdown-dateOptions input").click(function(){a(".stats-breakdown-value").hide();a(".stats-breakdown-value."+a(this).val()).show()});a("#dashboard-dateOptions-custom-from").datepicker({defaultDate:"-15d",maxDate:"0d",onSelect:function(K){var I=a("#dashboard-dateOptions-custom-to");var H=a(this).data("datepicker");var J=a.datepicker.parseDate(H.settings.dateFormat||a.datepicker._defaults.dateFormat,K,H.settings);I.datepicker("option","minDate",J)}});a("#dashboard-dateOptions-custom-to").datepicker({defaultDate:"-1d",maxDate:"0d",onSelect:function(K){var I=a("#dashboard-dateOptions-custom-from");var H=a(this).data("datepicker");var J=a.datepicker.parseDate(H.settings.dateFormat||a.datepicker._defaults.dateFormat,K,H.settings);I.datepicker("option","maxDate",J)}});a("#dashboard-apps-addAppButton").button({icons:{primary:"ui-icon-circle-plus"}});a("#dashboard-apps-editAppButton").button({icons:{primary:"ui-icon-wrench"}}).click(function(H){H.preventDefault();if(a("#dashboard-appEditForm").is(":visible")){a("#dashboard-appEditForm").slideUp("fast")}else{a("#dashboard-appEditForm").slideDown("fast")}});a("#dashboard-apps-addAdUnitButton").button({icons:{primary:"ui-icon-circle-plus"}}).click(function(H){H.preventDefault();if(a("#dashboard-adunitAddForm").is(":visible")){a("#dashboard-adunitAddForm").slideUp("fast")}else{a("#dashboard-adunitAddForm").slideDown("fast")}});a("#dashboard-apps-editAdUnitButton").button({icons:{primary:"ui-icon-wrench"}}).click(function(H){H.preventDefault();if(a("#dashboard-adunitEditForm").is(":visible")){a("#dashboard-adunitEditForm").slideUp("fast")}else{a("#dashboard-adunitEditForm").slideDown("fast")}});a("#appEditForm-submit").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(H){H.preventDefault();a("#appEditForm-loading").show();a("#appForm").submit()});a("#appEditForm-cancel").click(function(H){H.preventDefault();a("#dashboard-appEditForm").slideUp("fast")});a("#adunitAddForm-submit").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(H){H.preventDefault();a("#adunitForm-loading").show();a("#adunitAddForm").submit()});a("#adunitAddForm-cancel").click(function(H){H.preventDefault();a("#dashboard-adunitAddForm").slideUp("fast",function(){a("#dashboard-apps-addAdUnitButton").show()})});a("#adunitEditForm-submit").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(H){H.preventDefault();a("#adunitForm-loading").show();a("#adunitAddForm").submit()});a("#adunitEditForm-cancel").click(function(H){H.preventDefault();a("#dashboard-adunitEditForm").slideUp("fast")});a(".appData-details").each(function(){var J=a(this);var K=a(".appData-details-inner",J);var I=a(".appData-details-toggleButton",J);function M(){var N=a(".ui-button-text",I);if(N.length===0){N=I}return N}function H(){K.removeClass("hide");K.addClass("show");I.button("option",{icons:{primary:"ui-icon-triangle-1-n"}});M().text("Hide details")}function L(){K.removeClass("show");K.addClass("hide");I.button("option",{icons:{primary:"ui-icon-triangle-1-s"}});M().text("Show details")}if(K.hasClass("show")){H()}else{K.hide();L()}I.click(function(N){N.preventDefault();if(K.hasClass("show")){K.slideUp("fast");L()}else{K.slideDown("fast");H()}})});a(".appData-id").each(function(){var I=a(this);var H=I.parents("tr");H.hover(function(){I.show()},function(){I.hide()})});a("#appForm-submit").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(H){H.preventDefault();a("#appForm").submit()});function f(){a('input[name="app_type"]').click(function(H){a("#appForm .appForm-platformDependent").removeClass("iphone").removeClass("android").removeClass("mweb").addClass(a(this).val())}).filter(":checked").click()}f();a("#appForm-market-search-button").button({icons:{primary:"ui-icon-search"}}).click(function(I){I.preventDefault();a("#searchAppStore-loading").show();a("#dashboard-searchAppStore-custom-modal").dialog({buttons:[{text:"Cancel",click:function(){a("#searchAppStore-results").html("");a(this).dialog("close")}}]});var H=a('#appForm input[name="name"]').val();a.ajax({url:"/android_market_search/"+H,success:loadedArtwork,dataType:"json"})});a('#appForm input[name="app_type"]').click(function(H){a("#appForm .appForm-platformDependent").removeClass("iphone").removeClass("android").addClass(a(this).val())}).filter(":checked").click();a('input[name="name"]').change(function(){var H=a.trim(a(this).val());a("#appForm-adUnitName").val(H+" banner ad")});a("#appForm-search-button").button({icons:{primary:"ui-icon-search"}}).click(function(K){K.preventDefault();if(a(this).button("option","disabled")){return}a("#searchAppStore-loading").show();a("#dashboard-searchAppStore-custom-modal").dialog({buttons:[{text:"Cancel",click:function(){a("#searchAppStore-results").html("");a(this).dialog("close")}}]});var I=a('#appForm input[name="name"]').val();var H=document.createElement("script");H.src="http://ax.itunes.apple.com/WebObjects/MZStoreServices.woa/wa/wsSearch?entity=software&limit=10&callback=loadedArtwork&term="+I;var J=document.getElementsByTagName("head")[0];(J||document.body).appendChild(H)});if(a("#appForm-name").val()===""){a("#appForm-search-button").button("disable");a("#appForm-search").button("disable");a("#appForm-market-search-button").button("disable");a("#appForm-market-search").button("disable")}a("#appForm-name").keyup(function(J){var H=a.trim(a(this).val());var I=a('input:radio[name="app_type"]:checked').val();if(H.length){a("#appForm-search-button").button("enable");a("#appForm-market-search-button").button("enable")}else{a("#appForm-search-button").button("disable");a("#appForm-market-search-button").button("disable")}if(J.keyCode==13){if(I=="iphone"){a("#appForm-search-button").click()}else{if(I=="android"){a("#appForm-market-search-button").click()}}}});a("#appForm-changeIcon-link").click(function(H){H.preventDefault();a(this).hide();a("#appForm-icon-upload").show();a('#appForm input[name="img_url"]').val("")});a("#dashboard-delete-link").click(function(H){H.preventDefault();a("#dashboard-delete-modal").dialog({buttons:[{text:"Delete",click:function(){a(this).dialog("close");a("#dashboard-deleteForm").submit()}},{text:"Cancel",click:function(){a(this).dialog("close")}}]})});function m(){a("#adunit-device_format_phone").parent().buttonset();a("#adunit-device_format_phone").click(function(H){a("#adForm-tablet-container").hide();a("#adForm-phone-container").show().find('input[type="radio"]')[0].click()});a("#adunit-device_format_tablet").click(function(H){a("#adForm-phone-container").hide();a("#adForm-tablet-container").show().find('input[type="radio"]')[0].click()});a("#adForm-phone-formats").each(function(){var H=a(this);a('input[type="radio"]',H).click(function(N){var J=a(this);var M=J.parents(".adForm-format");a(".adForm-format-image").css({opacity:0.5});a(".adForm-format-image",M).css({opacity:1});var L=a(".full_only");var K=a(".banner_only");if(a(this).attr("id")=="appForm-adUnitFormat-full-tablet"||a(this).attr("id")=="appForm-adUnitFormat-full"){L.show();K.hide()}else{L.hide();K.show()}var I=a(".custom_only");if(a(this).attr("id")=="appForm-adUnitFormat-tablet-custom"||a(this).attr("id")=="appForm-adUnitFormat-custom"){I.show()}else{I.hide()}}).filter(":checked").click();a(".adForm-format-image",H).click(function(K){var J=a(this);var I=J.parents(".adForm-format");a('input[type="radio"]',I).click()});a('.adForm-format-details input[type="text"]',H).focus(function(){var I=a(this);var J=I.parents(".adForm-format");a('input[type="radio"]',J).click()})});a("#adForm-tablet-formats").each(function(){var H=a(this);a(this).find('input[type="radio"]').click(function(O){var K=a(this).parent().index();var I=a("#adForm-images-container");I.children().hide();var N=I.children()[K];a(N).show().css({opacity:1});var M=a(".full_only");var L=a(".banner_only");if(a(this).attr("id")=="appForm-adUnitFormat-full-tablet"||a(this).attr("id")=="appForm-adUnitFormat-full"){M.show();L.hide()}else{M.hide();L.show()}var J=a(".custom_only");if(a(this).attr("id")=="appForm-adUnitFormat-tablet-custom"||a(this).attr("id")=="appForm-adUnitFormat-custom"){J.show()}else{J.hide()}}).first().click()});a("#adunit-device_format_phone").parent().children().filter(":checked").click().each(function(){var I=a(this).val();var H="#adForm-"+I+"-container";a(H).find(".possible-format").click()})}m();a("#advertisers-testAdServer").button({icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(H){H.preventDefault();a("#adserverTest").dialog({buttons:{Close:function(){a(this).dialog("close")}}});a("#adserverTest-iFrame").attr("src",a("#adserverTest-iFrame-src").text())});a("#publisher-app-exportSelect").change(function(H){H.preventDefault();var I=a(this).val();if(I!="exp"){a("#appExportForm").find("#appExportType").val(I).end().submit()}a(this).selectmenu("index",0)});a("#publisher-app-exportSelect-menu").find("li").first().hide();var C={impression_count:"imp",request_count:"req",click_count:"clk",ctr:"ctr",fill_rate:"fill"};var v={};var B={};var s;function o(H){return a("#"+H).hasClass("app-row")}function q(H){return v[H]}function D(){return a(".app-row").map(function(){return this.id})}if(mopub.isDashboardPage){setTimeout(l,0)}else{mopub.Chart.setupDashboardStatsChart(e())}function l(){p();j(mopub.accountStats);var H=[];a(".appData").each(function(K,J){var M=a(J).find(".app-row")[0];var L=M.id;H.push(L);B[L]={};b(L,false);var I=a(J).find(".adunit-row");I.each(function(O,P){var N=P.id;H.push(N);B[N]={};v[N]=L})});s=new mopub.Utils.AjaxChunkedFetch({days:d()||14,startDate:r(),items:H,urlConstructor:F,chunkComplete:g,chunkFailure:G,fetchComplete:x});s.start()}function j(H){var I=H.all_stats["||"]["daily_stats"];mopub.dashboardStatsChartData={pointStart:mopub.graphStartDate,pointInterval:86400000,requests:[{Total:mopub.Stats.statArrayFromDailyStats(I,"request_count")}],impressions:[{Total:mopub.Stats.statArrayFromDailyStats(I,"impression_count")}],clicks:[{Total:mopub.Stats.statArrayFromDailyStats(I,"click_count")}],users:[{Total:mopub.Stats.statArrayFromDailyStats(I,"user_count")}]};mopub.Chart.setupDashboardStatsChart(e())}function p(){a("#ajaxRetry").click(function(H){k();a("#ajaxFailure").fadeOut();H.preventDefault()});a("#ajaxDismiss").click(function(H){a("#ajaxFailure").fadeOut();H.preventDefault()})}function k(){var H=D();H.each(function(I,J){if(!h(J)){b(J,false)}});s.retry()}function d(){var H=a("input[name=dashboard-dateOptions-option]:checked").val();if(!H||H=="custom"){var K=document.location.href;var J=/r=(\d+)/g;var I=J.exec(K);if(!I||I.length<2){return null}else{return I[1]}}else{return H}}function r(){var J=document.location.href;var I=/s=(\d+-\d+-\d+)/g;var H=I.exec(J);if(!H||H.length<2){return null}else{return H[1]}}function F(J,H){var I="/campaigns/stats/ajax/?";a.each(J,function(K,L){if(K==0){I+="pub="+L}else{I+="&pub="+L}});if(H.days){I+="&date_range="+H.days}if(H.startDate){I+="&start_date="+H.startDate}return I}function u(I){var H=a.extend(true,{},I);H.impression_count=mopub.Utils.formatNumberWithCommas(H.impression_count);H.request_count=mopub.Utils.formatNumberWithCommas(H.request_count);H.click_count=mopub.Utils.formatNumberWithCommas(H.click_count);H.ctr=mopub.Utils.formatNumberAsPercentage(H.ctr);H.fill_rate=mopub.Utils.formatNumberAsPercentage(H.fill_rate);return H}function g(N,J,I){var M=N.all_stats;for(var L in M){var O=L.split("||")[0];var K=M[L]["sum"];B[O]=M[L];var H=u(K);a.each(H,function(P,Q){z(O,P,Q)})}a.each(J,function(P,R){var Q=R;if(!o(R)){n(R);Q=q(R)}if(h(Q)){b(Q,true)}})}function h(H){return(a("#appData-"+H).find(".incomplete").length==0)}function n(H){a("#"+H).removeClass("incomplete").addClass("complete")}function z(L,K,J){if(!L){return}var I=C[K];if(!I){return}var H="#"+L+" ."+I;a(H).html(J)}function G(I,H){a("#ajaxFailure").show();a.each(I,function(J,L){var K=o(L)?L:q(L);b(K,true)})}function b(J,I){var H="#"+J+"-img";if(I){a(H).hide()}else{a(H).show()}}function x(H){E()}function E(){mopub.dashboardStatsChartData={pointStart:mopub.graphStartDate,pointInterval:86400000,requests:t(),impressions:w(),clicks:A(),users:y()};mopub.Chart.setupDashboardStatsChart(e())}function c(){var H=[];a.each(B,function(I,J){if(o(I)){var K={};K.key=J.name.replace("||","");K.stats=J;H.push(K)}});return H}function t(){var I=c();var H=mopub.Stats.sortStatsObjectsByStat(I,"request_count");return mopub.Stats.getGraphSummedStatsForStatName("request_count",H)}function w(){var I=c();var H=mopub.Stats.sortStatsObjectsByStat(I,"impression_count");return mopub.Stats.getGraphSummedStatsForStatName("impression_count",H)}function A(){var I=c();var H=mopub.Stats.sortStatsObjectsByStat(I,"click_count");return mopub.Stats.getGraphSummedStatsForStatName("click_count",H)}function y(){var I=c();var H=mopub.Stats.sortStatsObjectsByStat(I,"user_count");return mopub.Stats.getGraphSummedStatsForStatName("user_count",H)}})})(this.jQuery);var artwork_json;function loadedArtwork(c){if(!$("#dashboard-searchAppStore-custom-modal").dialog("isOpen")){return}$("#searchAppStore-results").html("");$("#searchAppStore-loading").hide();$("#dashboard-searchAppStore-custom-modal").dialog("close");artwork_json=c;var a=c.resultCount;if(a==0){$("#searchAppStore-results").append("<div class='adForm-appSearch-text' />").append("No results found");$("#dashboard-searchAppStore-custom-modal").dialog("open");return}for(var b=0;b<a;b++){if(b>10){break}var d=c.results[b];$("#searchAppStore-results").append($("<div class='adForm-appSearch' />").append($("<div class='adForm-appSearch-img' />").append($("<img />").attr("src",d.artworkUrl60).width(40).height(40)).append($("<span />"))).append($("<div class='adForm-appSearch-text' />").append($("<span />").append($('<a href="#" onclick="selectArtwork('+b+');return false";>'+d.trackName+"</a>")).append("<br />"+d.artistName))).append($("<div class='clear' />")))}$("#dashboard-searchAppStore-custom-modal").dialog("open")}function selectArtwork(a){$("#searchAppStore-results").html("");$("#appForm-icon").html("");$("#dashboard-searchAppStore-custom-modal").dialog("close");var d=artwork_json.results[a];var b=$('input:radio[name="app_type"]:checked').val();var c=$("app_form");$('#appForm input[name="name"]').val(d.trackName);$('#appForm input[name="description"]').val(d.description);if(b=="iphone"){$('#appForm input[name="url"]').val(d.trackViewUrl)}else{if(b=="android"){$('#appForm input[name="package"]').val(d.trackViewUrl)}}$('#appForm input[name="img_url"]').val(d.artworkUrl60);$('#appForm select[name="primary_category"]').val(d.primaryGenreName.toLowerCase());$('#appForm select[name="secondary_category"]').val(d.genres[1].toLowerCase());$("#appForm-icon").append($("<img />").attr("src",d.artworkUrl60).width(40).height(40).append($("<span />")))};