var mopub=window.mopub||{};(function(f,g,a){var c=g.View.extend({initialize:function(){this.collection.bind("change",this.render,this)},filtered_collection:function(){var h=f("#campaigns-filterOptions").find(":checked").val();var i=f("#campaigns-appFilterOptions").val();return new AdGroups(this.collection.reject(function(j){return(h&&h!==j.get("status"))||(i&&j.get("apps").indexOf(i)===-1)}))},render:function(){var i=this.filtered_collection();f("#campaigns-filterOptions").buttonset({disabled:!i.isFullyLoaded()});var h;if(i.size()===0){h="<h2>No "+this.options.title+"</h2>"}else{h=a.template(f("#adgroups-rollup-template").html(),{adgroups:i,title:this.options.title,type:this.options.type});if(this.options.tables){var j=this.options.type;a.each(this.options.tables,function(l,m){var k=new AdGroups(i.filter(l));if(k.length){h+=a.template(f("#adgroups-table-template").html(),{adgroups:k,title:m,type:j})}})}else{h+=a.template(f("#adgroups-table-template").html(),{adgroups:i,title:"Name",type:this.options.type})}}f(this.el).html(h);return this}});var b=g.View.extend({initialize:function(){this.collection.bind("change",this.render,this)},show_chart:function(){if(this.collection.isFullyLoaded()){var h=f("#dashboard-stats .stats-breakdown .active");var i=h.attr("id")==="stats-breakdown-ctr";mopub.Chart.setupDashboardStatsChart(i?"line":"area")}},render:function(){var i=this;if(i.collection.isFullyLoaded()){var h=["impression_count","revenue","click_count","ctr"];f.each(h,function(k,l){var j="#stats-breakdown-"+l+" .all .inner";f(j).html(i.collection.get_formatted_stat(l))});if(i.options.yesterday!==null&&i.options.today!==null){f.each(h,function(k,l){console.log("i was called");var j="#stats-breakdown-"+l+" .yesterday .inner";f(j).html(i.collection.get_formatted_stat_for_day(l,i.options.yesterday))});f.each(h,function(k,l){var j="#stats-breakdown-"+l+" .today .inner";f(j).html(i.collection.get_formatted_stat_for_day(l,i.options.today))})}mopub.dashboardStatsChartData={pointStart:i.options.start_date,pointInterval:86400000,impression_count:i.collection.get_chart_data("impression_count"),revenue:i.collection.get_chart_data("revenue"),click_count:i.collection.get_chart_data("click_count"),ctr:i.collection.get_chart_data("ctr")};i.show_chart()}}});var e=g.View.extend({initialize:function(){try{this.template=a.template(f("#app-template").html())}catch(h){}},renderInline:function(){var h=f("tr.app-row#app-"+this.model.id,this.el);f(".revenue",h).text(mopub.Utils.formatCurrency(this.model.get("revenue")));f(".impressions",h).text(mopub.Utils.formatNumberWithCommas(this.model.get("impressions")));f(".ecpm",h).text(mopub.Utils.formatCurrency(this.model.get("ecpm")));f(".clicks",h).text(mopub.Utils.formatNumberWithCommas(this.model.get("clicks")));f(".ctr",h).text(mopub.Utils.formatNumberAsPercentage(this.model.get("ctr")));f(".fill_rate",h).text(mopub.Utils.formatNumberAsPercentage(this.model.get("fill_rate")));f(".requests",h).text(mopub.Utils.formatNumberWithCommas(this.model.get("requests")));f(".attempts",h).text(mopub.Utils.formatNumberWithCommas(this.model.get("requests")));f(".conversions",h).text(mopub.Utils.formatNumberWithCommas(this.model.get("conversions")));f(".conv_rate",h).text(mopub.Utils.formatNumberAsPercentage(this.model.get("conversion_rate")));f(".loading-img",h).hide();return this},render:function(){var h=f(this.template(this.model.toJSON()));f("tbody",this.el).append(h);return this}});var d=g.View.extend({initialize:function(){try{this.template=a.template(f("#adunit-template").html())}catch(h){}},renderInline:function(){var i=this.model;var h=f("tr.adunit-row#adunit-"+this.model.id,this.el);f(".revenue",h).text(mopub.Utils.formatCurrency(this.model.get("revenue")));f(".ecpm",h).text(mopub.Utils.formatCurrency(this.model.get("ecpm")));f(".impressions",h).text(mopub.Utils.formatNumberWithCommas(this.model.get("impressions")));f(".price_floor",h).html('<img class="loading-img hidden" src="/images/icons-custom/spinner-12.gif"></img> <input id="'+this.model.id+'" type="text" class="input-text input-text-number number" style="width:50px;margin: -3px 0;" value="'+this.model.get("price_floor")+'"> ');f(".targeting",h).html('<img class="loading-img hidden" src="/images/icons-custom/spinner-12.gif"></img> <input class="targeting-box" type="checkbox">');f(".fill_rate",h).text(mopub.Utils.formatNumberAsPercentage(this.model.get("fill_rate")));f(".ctr",h).text(mopub.Utils.formatNumberAsPercentage(this.model.get("ctr")));f(".clicks",h).text(mopub.Utils.formatNumberWithCommas(this.model.get("clicks")));f(".requests",h).text(mopub.Utils.formatNumberWithCommas(this.model.get("requests")));f(".attempts",h).text(mopub.Utils.formatNumberWithCommas(this.model.get("requests")));f(".conversions",h).text(mopub.Utils.formatNumberWithCommas(this.model.get("conversions")));f(".conv_rate",h).text(mopub.Utils.formatNumberAsPercentage(this.model.get("conversion_rate")));if(this.model.get("active")){f("input.targeting-box",h).attr("checked","checked")}f("input.targeting-box",h).click(function(){var j=f(".targeting .loading-img",h);j.show();i.save({active:f(this).is(":checked")},{success:function(){setTimeout(function(){j.hide()},2000)}})});f(".price_floor .input-text",h).keyup(function(){var k=f(this);k.removeClass("error");var j=f(".price_floor .loading-img",h);j.show();var l=i.save({price_floor:f(this).val()});if(l){l.success(function(){j.hide()});l.error(function(){j.hide()})}else{j.hide();k.addClass("error")}});return this},render:function(){var k=this.model;var i=f(this.template(this.model.toJSON()));f(".price_floor_change",i).change(function(){k.set({price_floor:f(this).val()});var l=f(".save",f(this).parent());l.click(function(m){m.preventDefault();l.addClass("disabled").text("Saving...");k.save({},{success:function(){setTimeout(function(){l.removeClass("disabled").text("Saved");l.text("Save")},2000)}})})});f("input.targeting-box",i).click(function(){var l=f(this).attr("name");var m=f(this).is(":checked")?"On":"Off";f('label[for="'+l+'"]',i).text(m);k.set({active:f(this).is(":checked")});k.save()});var j=f("tr#app-"+this.model.get("app_id"),this.el);var h=j.hasClass("even")?"even":"odd";i.addClass(h);j.after(i);return this}});window.AdUnitView=d;window.AppView=e;window.AdGroupsView=c;window.CollectionGraphView=b}(this.jQuery,this.Backbone,this._));