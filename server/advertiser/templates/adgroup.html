{% extends "advertiser/base.html" %}

{% load filters %}

{% block title %}{{campaign.name}}{% endblock %}
{% block content %}
<style type="text/css">
#highlight.gradient {
  background: -webkit-gradient(linear, left top, left bottom, from(rgba(255,255,255,0.35)),
    to(rgba(255,255,255,0.06))); -webkit-background-origin: padding-box; -webkit-background-clip: content-box;
  background: -moz-linear-gradient(rgba(255, 255, 255, 0.35) 0%, rgba(255, 255, 255, 0.06) 95%);
}
</style>
<script type="text/javascript">
function updateLine1() {$('line1sample').innerHTML = $('line1').value;}
function updateLine2() {$('line2sample').innerHTML = $('line2').value;}
function updateColor() {color=$('color').value;if (color.match(/^[0-9a-f]{6}$/i)) $('preview').style.backgroundColor='#'+color;}
function updateFontColor() {color=$('font_color').value;if (color.match(/^[0-9a-f]{6}$/i)){$('line1sample').style.color='#'+color; $('line2sample').style.color='#'+color;}} 
function updateGradient() {$('highlight').toggleClassName('gradient');}
function changeIcon() {$('app_img').value='';$('image_input').show();$('image_input_change').hide();
}
function setAction(icon) {if (icon=="none"){$('action_icon').hide();return;}$('action_icon').show();$('action_icon').src = '/images/'+icon+'.png';}
function setApp(name,url,key) {
  $('image_input_div').innerHTML = $('image_input_div').innerHTML;
  $('line1').value = name;
  $('line1sample').innerHTML = name;
  $('line2sample').innerHTML = '';
  $('url').value = url;
  $('thumb').src = (key) ? '/inventory/app/icon/'+key : '/images/noicon.png';
  $('image_input').hide();
  $('image_input_change').show();
  $('app_img').value = key;
}
</script>
	<h3>
		<a href="{% url advertiser_campaign %}">Campaigns</a> &gt; 
		<!--<a href="{% url advertiser_campaign_show campaign_key=campaign.key %}">{{campaign.name}}</a> &gt;-->
		{{adgroup.name}}
		<div class="toolbar">
			<a href="{% url advertiser_adgroup_edit adgroup_key=adgroup.key %}">
				Edit {{adgroup.name}}
			</a>
		</div>
	</h3>
	
	<table class="rollups">
		<tr>
			<td class="rollup rollup_selected" onClick="show_graph_imp(this);"><b>Impressions</b><br/>{{today.impression_count|withsep}}</td>
			<td class="rollup" onClick="show_graph_clk(this);"><b>Clicks</b><br/>{{today.click_count|withsep}} ({{today.ctr|percentage}})</td>
			<td class="rollup" onClick="show_graph_rev(this);"><b>Revenue</b><br/>{{today.revenue|currency}}</td>
		</tr>
	</table>
	
	<img id="chart_img" src="{{chart_urls.imp}}" width=780 height=200 style="padding: 5px 0 10px 0;"/>
	
	<h3>Settings</h3>
	
	<table>
		<tr><th>Priority level</th>
			<td class="numeric">
				{% ifequal adgroup.priority_level 1 %}Sponsorship{% endifequal %}
				{% ifequal adgroup.priority_level 2 %}Direct{% endifequal %}
				{% ifequal adgroup.priority_level 3 %}Promotional{% endifequal %}
				{% ifequal adgroup.priority_level 4 %}Network{% endifequal %}
			</td></tr>
			<tr><th>Max Bid</th><td class="numeric">{{adgroup.bid|currency}}</td></tr>
			<tr><th>Bid strategy</th>
				<td class="numeric">{% ifequal adgroup.bid_strategy "cpc" %}By click (CPC){% endifequal %}
					{% ifequal adgroup.bid_strategy "cpm" %}By impression (CPM){% endifequal %}</td></tr>
			<tr><th>Geo predicates</th><td class="numeric">{% for g in adgroup.geo_predicates %}{{g}}<br/>{% endfor %}</td></tr>
			<tr><th>Device predicates</th><td class="numeric">{% for g in adgroup.device_predicates %}{{g}}<br/>{% endfor %}</td></tr>
	</table>
	
	<h3>
		Ad Unit Targeting
	</h3>
	<table class="wide">
		{% if keywords %}
			<thead>
				<th>Keyword</th>
				<th class="numeric">Impr.</th>
				<th class="numeric">Clicks</th>
				<th class="numeric">Cost</th>
			</thead>
		{% endif %}
		{% for k in keywords %}
			<tr>
				<td>{{k.keyword}}</td>
				<td>{{k.stats.impression_count}}</td>
				<td>{{k.stats.click_count}} ({{k.stats.ctr|percentage}})</td>
				<td>{{k.stats.revenue|currency}}</td>
			</tr>
		{% endfor %}
	</table>
		 
	<table class="wide">
		{% if sites %}
			<thead>
				<th>Name</th>
				<th class="numeric">Impr.</th>
				<th class="numeric">Clicks</th>
				<th class="numeric">Cost</th>
			</thead>
		{% endif %}
		{% for s in sites %}
			<tr>
				<td>{{s.app.name}} > <a href="/inventory/adunit?id={{s.key}}">{{s.name}}</a></td>
				<td class="numeric">{{s.stats.impression_count}}</td>
				<td class="numeric">{{s.stats.click_count}} ({{s.stats.ctr|percentage}})</td>
				<td class="numeric">{{s.stats.revenue|currency}}</td>
			</tr>
		{% empty %}
			<tr><td>No ad units targeted.</td></tr>
		{% endfor %}
	</table>
	
	{% ifnotequal adgroup.campaign.campaign_type "network" %}
		<h3>
			Ad Creatives
			<div class="toolbar">
				<a href="#" onclick="javascript:Toggle.display('add_text_image_creative_box');return false;">
					Create Text and Icon Ad
				</a>
				|
				<a href="#" onclick="javascript:Toggle.display('add_creative_box');return false;">
					Create Text Ad
				</a>
				|
				<a href="#" onclick="javascript:Toggle.display('add_image_creative_box');return false;">
					Create Image Ad
				</a>			
				|
				<a href="#" onclick="javascript:Toggle.display('add_html_creative_box');return false;">
					Create Html Ad
				</a>			
			</div>
		</h3>
		<form method="post" action="{% url advertiser_creative_create %}" enctype="multipart/form-data"
			id="add_creative_box" style="display:none;" class="special_notice">		
			<input type="hidden" name="id" value="{{adgroup.key}}"/>
			<table>
				<tr><th>Headline</th><td><input type='text' name="headline" size="40"/></td></tr>
				<tr><th>Line 1</th><td><input type='text' name="line1" size="30"/></td></tr>
				<tr><th>Line 2</th><td><input type='text' name="line2" size="30"/></td></tr>
				<tr><th>URL</th><td><input type='text' name="url" size="50"/></td></tr>
				<tr><th>Display URL</th><td><input type='text' name="display_url" size="35"/></td></tr>
				<tr><th>Impression Tracking Pixel</th><td><input type='text' name="tracking_url" size="35"/></td></tr>
				<tr><th></th><td><input type='submit' value="Create Ad &raquo;"/></td></tr>
			</table>
		</form>
		
		<form method="post" action="{% url advertiser_creative_create %}" enctype="multipart/form-data"
			id="add_text_image_creative_box" style="display:none;" class="special_notice">		
			<input type="hidden" name="id" value="{{adgroup.key}}"/>
			<table><tr><td>
			<table>
				<tr><th>Line 1</th><td><input id='line1' type='text' name="line1" size="30" onkeyup='updateLine1();'/></td></tr>
				<tr><th>Line 2</th><td><input id='line2' type='text' name="line2" size="30" onkeyup='updateLine2();'/></td></tr>
				<tr><th>Image File<br/><span style="font-size:smaller;margin-left:5px;">(40 x 40)</span></th><td><div id='image_input_div'><input id='image_input' type='file' name="image" size="40"/></div><div id='image_input_change' style='display:none;'><a href="#" onclick="changeIcon();return false;">Change</a></div></td></tr>
				<input type="hidden" id="app_img" name="app_img"/>
				<tr><th>URL</th><td><input type='text' id='url' name="url" size="50"/></td></tr>
				<tr><th>Action Icon</th><td>
				    <input type="radio" name="action_icon" value="download_arrow4" onclick="setAction('download_arrow4');" checked/><img src="/images/download_arrow4.png"/>
				    <input type="radio" name="action_icon" value="access_arrow" onclick="setAction('access_arrow');"/><img src="/images/access_arrow.png"/>
				    <input type="radio" name="action_icon" value="none" onclick="setAction('none');"/> None
				    <input type="radio" name="action_icon" value="custom" onclick="setAction('custom');" disabled/> Custom
				</td>
				<tr><th>Color</th><td><input type='text' id='color' name="color" size="8" value="000000" onkeyup='updateColor();'/></td></tr>
				<tr><th>Font Color</th><td><input type='text' id='font_color' name="font_color" size="8" value="FFFFFF" onkeyup='updateFontColor();'/></td></tr>
				<tr><th>Gradient</th><td><input type='checkbox' id='gradient' name="gradient" checked onchange='updateGradient()'/></td></tr>
			</table>
			</td><td valign="top">
			  <table><tr><td>
			    <div>
			      <strong>Or create an ad for an existing App</strong><br />
			      {% for a in apps %}
        		<div style="position:relative;">
      		  <img height="40px" width="40px" src="{% if a.icon_url %}{{a.icon_url}}{% else %}/images/noicon.png{% endif %}" width=$w height=$h/>
      		  <a href="#" onclick="setApp('{{a.name}}','{{a.url}}',{% if a.icon_url %}'{{a.key}}'{% else %}null{% endif %});return false;">{{a.name}}</a>
      		  <span style="background:url(/images/mask40.png);display:block;position:absolute; left:-1px;top:0px;z-index:1;height:42px;width:41px;')"</span>
      		  </div>
			      {% endfor %}
			    </div>
			    </td></tr></table>
			</td></tr>
			</table>
      <strong>Preview</strong>
      <div id='preview' style="width:320px;border:1px solid black;background-color:#000000;">
        <div id='highlight' class="gradient" style="height:50px;">
        <div style="margin:5px;width:40px;height:40px;float:left"><img id="thumb" src="/images/noicon.png" width=40 height=40/></div>
        <div style="float:left;width:230px;height:10px">
          <div id="line1sample" style="color:white;font-weight:bold;margin:5px 0 0 5px;"></div>
          <div id="line2sample" style="color:white;margin-top:5px;margin:5px 0 0 5px;"></div>
        </div>
        <div style="padding-top:5px;"><a href="$url"><img id="action_icon" src="/images/download_arrow4.png" width=40 height=40/></a></div>
      </div>
      </div>
      <br />
      <input type='submit' value="Create Ad &raquo;"/>
		</form>
		
		<form method="post" action="{% url advertiser_creative_create %}" enctype="multipart/form-data"
			id="add_image_creative_box" style="display:none;" class="special_notice">		
			<input type="hidden" name="id" value="{{adgroup.key}}"/>
			<table>
				<tr><th>Image File</th><td><input type='file' name="image" size="40"/></td></tr>
				<tr><th>URL</th><td><input type='text' name="url" size="50"/></td></tr>
				<tr><th>Impression Tracking Pixel</th><td><input type='text' name="tracking_url" size="35"/></td></tr>
				<tr><th></th><td><input type='submit' value="Create Ad &raquo;"/></td></tr>
			</table>
		</form>
		<form method="post" action="{% url advertiser_creative_create %}" enctype="multipart/form-data"
			id="add_html_creative_box" style="display:none;" class="special_notice">		
			<input type="hidden" name="id" value="{{adgroup.key}}"/>
			<table>
				<tr><th>Name</th><td><input type='text' name="html_name"></td></tr>
				<tr><th>HTML Snippet</th><td><textarea name="html_data"></textarea></td></tr>
				<tr><th>Impression Tracking Pixel</th><td><input type='text' name="tracking_url" size="35"/></td></tr>
				<tr><th></th><td><input type='submit' value="Create Ad &raquo;"/></td></tr>
			</table>
		</form>
	
		<form method="post" action="{% url advertiser_creative_delete %}">
		<table class="creatives wide">
		{% if creatives %}
			<thead>
				<th></th>
				<th>Creative</th>
				<th>Status</th>
				<th class="numeric">Impr.</th>
				<th class="numeric">Clicks</th>
				<th class="numeric">Cost</th>
			</thead>
		{% endif %}
		{% for c in creatives %}
			<tr>
				<td><input type="checkbox" name="id" value="{{c.key}}"></input></td>
				<td>
					{% ifequal c.ad_type "text" %}
					<div class="creative">
						<a href="{{c.url}}" class="creative_headline">{{c.headline}}</a><br/>
						{{c.line1}}<br/>
						{{c.line2}}<br/>
						<span class="creative_url"><a href="{{c.url}}">{{c.display_url}}</a></span>
					</div>
					{% endifequal %}
					{% ifequal c.ad_type "text_icon" %}
					<div style="width:320px;border:1px solid black;background-color:#{% if c.color %}{{c.color}}{% else %}000000{% endif %};">
					  <div id='highlight' style="position:relative;height:50px;" {% if c.gradient %}class="gradient"{% endif %}>
            {% if c.image %}
            <div id="img_preview" style="margin:5px;width:40px;height:40px;float:left">
              <img width="40" height="40" id="thumb" src="{% url advertiser_creative_image creative_key=c.key %}"/>
            </div>
            {% endif %}
            <div style="float:left;width:230px;height:10px">
              <div id="line1sample" style="color:white;font-weight:bold;margin:5px 0 0 5px;">{{c.line1}}</div>
              <div id="line2sample" style="color:white;margin-top:5px;margin:5px 0 0 5px;">{{c.line2}}</div>
            </div>
            {% ifnotequal c.action_icon "none" %}
            <div style="padding-top:5px;position:absolute;top:0;right:0;"><a href="$url"><img id="action_icon" src="/images/{{c.action_icon}}.png" width=40 height=40/></a></div>
            {% endifnotequal %}
            </div>
          </div>
          <span style="font-size:smaller;color:grey;">URL: {{c.url}}</span>
					{% endifequal %}
					{% ifequal c.ad_type "image" %}
					<div class="creative">
						<a href="{{c.url}}">
							<img src="{% url advertiser_creative_image creative_key=c.key %}">
						</a>
					</div>
					{% endifequal %}
					{% ifequal c.ad_type "html" %}
					{{c.html_name}}
					<div class="creative">
					  <iframe src="{% url advertiser_creative_html creative_key=c.key %}" frameborder="0" scrolling="no" width="100%" height="50">
              <p>Your browser does not support iframes.</p>
            </iframe>
					</div>
					{% endifequal %}
					<div class="clearall"></div>
				</td>
				<td>
					<b>
						{% if c.deleted %}
							Deleted
						{% endif %}
						{% if c.active and not c.deleted %}
							Active
						{% endif %}
						{% if not c.active and not c.deleted %}
							Paused
						{% endif %}
					</b>
				</td>
				<td class="numeric">{{c.stats.impression_count}}</td>
				<td class="numeric">{{c.stats.click_count}} ({{c.stats.ctr|percentage}})</td>
				<td class="numeric">{{c.stats.revenue|currency}}</td>
			</tr>
		{% endfor %}
		{% if creatives %}
			<tr>
				<td colspan=8>
					<p></p><input type='submit' name='delete' value='Delete Ads'/>
				</td>
			</tr>
		{% else %}
			<tr>
				<td colspan=8>
					<p>No creatives.</p>
				</td>
			</tr>			
		{% endif %}
		</table>
		</form>
	{% endifnotequal %}
	
{% endblock %}
