{% extends "base.html" %}
{% load filters %}
{% block navLinks %}
<li><a href="{% url app_index %}">Dashboard</a></li>
<li><a href="{% url advertiser_campaign %}">Campaigns</a></li>
<li><a href="{% url marketplace_index %}">Marketplace</a></li>
<li class="active"><a href="{% url network_index %}">Networks</a></li>
{% endblock navLinks %}

{% block titleBarRight %}
{% endblock titleBarRight %}

{% block extraScripts %}
<script type="text/javascript">
    $(function() {
            // TODO: put in shared js file with dashboard. Note: latest date allowed in range is yesterday.
            // set up dateOptions
            $('#dashboard-dateOptions input').click(function() {
                    var option = $(this).val();
                    if(option == 'custom') {
                        $('#dashboard-dateOptions-custom-modal').dialog({
                            width: 570,
                            buttons: [
                                {text: 'Set dates',
                                 css: { fontWeight: '600' },
                                 click: function() {
                                     var from_date=$('#dashboard-dateOptions-custom-from').datepicker("getDate");
                                     var to_date=$('#dashboard-dateOptions-custom-to').datepicker("getDate");
                                     var num_days=Math.ceil((to_date.getTime()-from_date.getTime())/(86400000)) + 1;

                                     var from_day=from_date.getDate();
                                     var from_month=from_date.getMonth()+1;
                                     var from_year=from_date.getFullYear();

                                     $(this).dialog("close");
                                         var location = document.location.href.replace(/\?.*/,'');
                                         document.location.href = location+'?r='+num_days+'&s='+from_year+"-"+from_month+"-"+from_day;
                                 }
                                },
                                {text: 'Cancel',
                                 click: function() {
                                    $(this).dialog("close");
                                 }
                                }
                            ]
                        });
                    }
                    else {
                        // Tell server about selected option to get new data
                        var location = document.location.href.replace(/\?.*/,'');
                        document.location.href = location+'?r=' + option;
                    }
            });

            // set up stats breakdown dateOptions
            $('#stats-breakdown-dateOptions input').click(function() {
                    $('.stats-breakdown-value').hide();
                    $('.stats-breakdown-value.'+$(this).val()).show();
                    });

            // set up custom dateOptions model dialog
            $('#dashboard-dateOptions-custom-from').datepicker({
                defaultDate: '-15d',
                maxDate: '-1d',
                onSelect: function(selectedDate) {
                    var other = $('#dashboard-dateOptions-custom-to');
                    var instance = $(this).data("datepicker");
                    var date = $.datepicker.parseDate(instance.settings.dateFormat || $.datepicker._defaults.dateFormat, selectedDate, instance.settings);
                    other.datepicker('option', 'minDate', date);
                }
            });
            $('#dashboard-dateOptions-custom-to').datepicker({
                defaultDate: '-1d',
                maxDate: '-1d',
                onSelect: function(selectedDate) {
                    var other = $('#dashboard-dateOptions-custom-from');
                    var instance = $(this).data("datepicker");
                    var date = $.datepicker.parseDate(instance.settings.dateFormat || $.datepicker._defaults.dateFormat, selectedDate, instance.settings);
                    other.datepicker('option', 'maxDate', date);
                }
            });
    });
</script>
{% endblock extraScripts %}

{% block dateButtons %}
{% include "partials/datecontrols.html" %}
{% endblock dateButtons %}


{% block content %}

{% block preContent %}
{% endblock preContent %}

{% block graph %}
{% if graph %}
<section class="offset nomargin" id="dashboard-stats">
<h3 class="stats-chart-title">
    Realtime Stats for {{start_date|format_date_compact}} to {{end_date|format_date_compact}}
</h3>
{# Controls and stats breakdown for the top realtime stats #}
<div class="stats">
    {% comment %}
    {% stats_breakdown stats %}
    {% endcomment %}
    <div class="stats">
        <div class="stats-breakdown">
            <table>
                <tbody>
                    {% if reporting %}
                    <tr id="stats-breakdown-revenue">
                        <td class="stats-breakdown-value today">
                            <span class="inner network-chart-data"></span>
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <td class="stats-breakdown-value yesterday">
                            <span class="inner network-chart-data"></span>
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <td class="stats-breakdown-value all">
                            <span class="inner network-chart-data"></span>
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <th class="stats-breakdown-name">
                            <span class="inner">Revenue</span>
                        </th>
                    </tr>
                    {% endif %}

                    <tr class="active" id="stats-breakdown-impression_count">
                        <td class="stats-breakdown-value today">
                            {% if reporting %}
                            <span class="inner network-chart-data"></span>
                            {% endif %}
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <td class="stats-breakdown-value yesterday">
                            {% if reporting %}
                            <span class="inner network-chart-data"></span>
                            {% endif %}
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <td class="stats-breakdown-value all">
                            {% if reporting %}
                            <span class="inner network-chart-data"></span>
                            {% endif %}
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <th class="stats-breakdown-name">
                            <span class="inner">Impressions</span>
                        </th>
                    </tr>

                    <tr id="stats-breakdown-click_count">
                        <td class="stats-breakdown-value today">
                            {% if reporting %}
                            <span class="inner network-chart-data"></span>
                            {% endif %}
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <td class="stats-breakdown-value yesterday">
                            {% if reporting %}
                            <span class="inner network-chart-data"></span>
                            {% endif %}
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <td class="stats-breakdown-value all">
                            {% if reporting %}
                            <span class="inner network-chart-data"></span>
                            {% endif %}
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <th class="stats-breakdown-name">
                            <span class="inner">Clicks</span>
                        </th>
                    </tr>

                    <tr id="stats-breakdown-cpm">
                        <td class="stats-breakdown-value today">
                            {% if reporting %}
                            <span class="inner network-chart-data"></span>
                            {% endif %}
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <td class="stats-breakdown-value yesterday">
                            {% if reporting %}
                            <span class="inner network-chart-data"></span>
                            {% endif %}
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <td class="stats-breakdown-value all">
                            {% if reporting %}
                            <span class="inner network-chart-data"></span>
                            {% endif %}
                            <span class="inner mopub-chart-data"></span>
                        </td>
                        <th class="stats-breakdown-name">
                            <span class="inner">CPM</span>
                        </th>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="stats-breakdown-buttons">
            <span class="buttonset button-small" id="stats-breakdown-dateOptions">
                <input type="radio" name="stats-breakdown-dateOptions-option" value="today" id="stats-breakdown-dateOptions-option-0" checked="checked"/>
                <label for="stats-breakdown-dateOptions-option-0">
                    Today
                </label>
                <input type="radio" name="stats-breakdown-dateOptions-option" value="yesterday" id="stats-breakdown-dateOptions-option-1"/>
                <label for="stats-breakdown-dateOptions-option-1">
                    Yesterday
                </label>
                <input type="radio" name="stats-breakdown-dateOptions-option" value="all" id="stats-breakdown-dateOptions-option-2"/>
                <label for="stats-breakdown-dateOptions-option-2">
                    All
                </label>
            </span>
        </div>
        <div class="chart stats-chart" id="dashboard-stats-chart"></div>
    </div>
</div>
</section>
{% else %}
<section id="graph">
<div class="alert-message block-message">
    MoPub can can mediate the ad networks where you have an account. ...more help text
</div>
</section>
{% endif %}
{% endblock graph %}

{% block innerContent %}
<section id="dashboard-apps">
<div class="buttonBank buttonBank-right">
    <select name='exportSelect' id='ad-network-exportSelect' class='selectmenu export-selectMenu'>
        <option value="exp">Export</option>
        <option value="/ad_network_reports/export/xls/{{mapper_key}}">XLS</option>
        <option value="/ad_network_reports/export/csv/{{mapper_key}}">CSV</option>
    </select>
</div>
<h2>{{app_name}} on {{ad_network_name}}</h2>
<div class="appData-details noneg" style="clear:both;">
    <table class="dataTable appData-main">
        <thead>
            <th class="dataTable-name big"></th>
            <th class="dataTable-data numeric special"> Revenue </th>
            {% if ad_network_name != MOBFOX %}
            <th class="dataTable-data numeric special"> Attempts </th>
            {% endif %}
            <th class="dataTable-data numeric special"> Impressions </th>
            <th class="dataTable-data numeric special"> CPM </th>
            {% if ad_network_name != MOBFOX %}
            <th class="dataTable-data numeric special"> Fill Rate</th>
            {% endif %}
            <th class="dataTable-data numeric special"> Clicks </th>
            <th class="dataTable-data numeric special"> CPC </th>
            <th class="dataTable-data numeric special"> CTR </th>
        </thead>
        <tbody>
            {% for stats in stats_list %}
            <tr>
                <td class="dataTable-name">{{stats.date}}</td>
                <td class="dataTable-data numeric">{{ stats.revenue|currency }}</td>
                {% if ad_network_name != MOBFOX %}
                <td class="dataTable-data numeric">{{ stats.attempts|withsep }}</td>
                {% endif %}
                <td class="dataTable-data numeric">{{ stats.impressions|withsep }}</td>
                <td class="dataTable-data numeric">{{ stats.cpm|currency }}</td>
                {% if ad_network_name != MOBFOX %}
                <td class="dataTable-data numeric">{{ stats.fill_rate|percentage }}</td>
                {% endif %}
                <td class="dataTable-data numeric">{{ stats.clicks|withsep }}</td>
                <td class="dataTable-data numeric">{{ stats.cpc|currency }}</td>
                <td class="dataTable-data numeric">{{ stats.ctr|percentage }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</section>
{% endblock innerContent %}

{% endblock content %}
